<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class Parslet::ErrorReporter::Contextual - parslet-1.7.0 Documentation</title>

<link type="text/css" media="screen" href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../../index.html">Home</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  

  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/parslet/error_reporter/contextual.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">Deepest
  
</nav>

    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li class="calls-super" ><a href="#method-i-err">#err</a>
    
    <li ><a href="#method-i-reset">#reset</a>
    
    <li ><a href="#method-i-succ">#succ</a>
    
    <li ><a href="#method-i-update_label">#update_label</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../../README.html">README</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../../Object.html">Object</a>
  
    <li><a href="../../Parslet.html">Parslet</a>
  
    <li><a href="../../Parslet/Accelerator.html">Parslet::Accelerator</a>
  
    <li><a href="../../Parslet/Accelerator/Application.html">Parslet::Accelerator::Application</a>
  
    <li><a href="../../Parslet/Accelerator/Apply.html">Parslet::Accelerator::Apply</a>
  
    <li><a href="../../Parslet/Accelerator/Engine.html">Parslet::Accelerator::Engine</a>
  
    <li><a href="../../Parslet/Accelerator/Expression.html">Parslet::Accelerator::Expression</a>
  
    <li><a href="../../Parslet/Atoms.html">Parslet::Atoms</a>
  
    <li><a href="../../Parslet/Atoms/Alternative.html">Parslet::Atoms::Alternative</a>
  
    <li><a href="../../Parslet/Atoms/Base.html">Parslet::Atoms::Base</a>
  
    <li><a href="../../Parslet/Atoms/CanFlatten.html">Parslet::Atoms::CanFlatten</a>
  
    <li><a href="../../Parslet/Atoms/Capture.html">Parslet::Atoms::Capture</a>
  
    <li><a href="../../Parslet/Atoms/Context.html">Parslet::Atoms::Context</a>
  
    <li><a href="../../Parslet/Atoms/DSL.html">Parslet::Atoms::DSL</a>
  
    <li><a href="../../Parslet/Atoms/Dynamic.html">Parslet::Atoms::Dynamic</a>
  
    <li><a href="../../Parslet/Atoms/Entity.html">Parslet::Atoms::Entity</a>
  
    <li><a href="../../Parslet/Atoms/Infix.html">Parslet::Atoms::Infix</a>
  
    <li><a href="../../Parslet/Atoms/Lookahead.html">Parslet::Atoms::Lookahead</a>
  
    <li><a href="../../Parslet/Atoms/Named.html">Parslet::Atoms::Named</a>
  
    <li><a href="../../Parslet/Atoms/Precedence.html">Parslet::Atoms::Precedence</a>
  
    <li><a href="../../Parslet/Atoms/Re.html">Parslet::Atoms::Re</a>
  
    <li><a href="../../Parslet/Atoms/Repetition.html">Parslet::Atoms::Repetition</a>
  
    <li><a href="../../Parslet/Atoms/Scope.html">Parslet::Atoms::Scope</a>
  
    <li><a href="../../Parslet/Atoms/Sequence.html">Parslet::Atoms::Sequence</a>
  
    <li><a href="../../Parslet/Atoms/Str.html">Parslet::Atoms::Str</a>
  
    <li><a href="../../Parslet/Cause.html">Parslet::Cause</a>
  
    <li><a href="../../Parslet/ClassMethods.html">Parslet::ClassMethods</a>
  
    <li><a href="../../Parslet/Context.html">Parslet::Context</a>
  
    <li><a href="../../Parslet/DelayedMatchConstructor.html">Parslet::DelayedMatchConstructor</a>
  
    <li><a href="../../Parslet/ErrorReporter.html">Parslet::ErrorReporter</a>
  
    <li><a href="../../Parslet/ErrorReporter/Contextual.html">Parslet::ErrorReporter::Contextual</a>
  
    <li><a href="../../Parslet/ErrorReporter/Deepest.html">Parslet::ErrorReporter::Deepest</a>
  
    <li><a href="../../Parslet/ErrorReporter/Tree.html">Parslet::ErrorReporter::Tree</a>
  
    <li><a href="../../Parslet/Expression.html">Parslet::Expression</a>
  
    <li><a href="../../Parslet/Expression/Treetop.html">Parslet::Expression::Treetop</a>
  
    <li><a href="../../Parslet/Expression/Treetop/Parser.html">Parslet::Expression::Treetop::Parser</a>
  
    <li><a href="../../Parslet/Expression/Treetop/Transform.html">Parslet::Expression::Treetop::Transform</a>
  
    <li><a href="../../Parslet/Graphable.html">Parslet::Graphable</a>
  
    <li><a href="../../Parslet/GraphvizVisitor.html">Parslet::GraphvizVisitor</a>
  
    <li><a href="../../Parslet/ParseFailed.html">Parslet::ParseFailed</a>
  
    <li><a href="../../Parslet/Parser.html">Parslet::Parser</a>
  
    <li><a href="../../Parslet/Parser/PrettyPrinter.html">Parslet::Parser::PrettyPrinter</a>
  
    <li><a href="../../Parslet/Parser/Visitors.html">Parslet::Parser::Visitors</a>
  
    <li><a href="../../Parslet/Parser/Visitors/Citrus.html">Parslet::Parser::Visitors::Citrus</a>
  
    <li><a href="../../Parslet/Parser/Visitors/Treetop.html">Parslet::Parser::Visitors::Treetop</a>
  
    <li><a href="../../Parslet/Pattern.html">Parslet::Pattern</a>
  
    <li><a href="../../Parslet/Pattern/SequenceBind.html">Parslet::Pattern::SequenceBind</a>
  
    <li><a href="../../Parslet/Pattern/SimpleBind.html">Parslet::Pattern::SimpleBind</a>
  
    <li><a href="../../Parslet/Pattern/SubtreeBind.html">Parslet::Pattern::SubtreeBind</a>
  
    <li><a href="../../Parslet/Position.html">Parslet::Position</a>
  
    <li><a href="../../Parslet/Scope.html">Parslet::Scope</a>
  
    <li><a href="../../Parslet/Scope/Binding.html">Parslet::Scope::Binding</a>
  
    <li><a href="../../Parslet/Scope/NotFound.html">Parslet::Scope::NotFound</a>
  
    <li><a href="../../Parslet/Slice.html">Parslet::Slice</a>
  
    <li><a href="../../Parslet/Source.html">Parslet::Source</a>
  
    <li><a href="../../Parslet/Source/LineCache.html">Parslet::Source::LineCache</a>
  
    <li><a href="../../Parslet/Source/RangeSearch.html">Parslet::Source::RangeSearch</a>
  
    <li><a href="../../Parslet/Transform.html">Parslet::Transform</a>
  
    <li><a href="../../RSpec.html">RSpec</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Parslet::ErrorReporter::Contextual</h1>

  <div id="description" class="description">
    
<p>A reporter that tries to improve on the deepest error reporter by using
heuristics to find the most relevant error and provide more context. The
heuristic chooses the deepest error when parsing a sequence for which no
alternative parsed successfully.</p>

<p>Given the following parser:</p>

<p>root(:call)</p>

<p>rule(:call, label: &#39;call&#39;) {</p>

<pre>identifier &gt;&gt; str(&#39;.&#39;) &gt;&gt; method</pre>

<p>}</p>

<p>rule(:method, label: &#39;method call&#39;) {</p>

<pre>identifier &gt;&gt; str(&#39;(&#39;) &gt;&gt; arguments.maybe &gt;&gt; str(&#39;)&#39;)</pre>

<p>}</p>

<p>rule(:identifier, label: &#39;identifier&#39;) {</p>

<pre>match[&#39;[:alnum:]&#39;].repeat(1)</pre>

<p>}</p>

<p>rule(:arguments, label: &#39;method call arguments&#39;) {</p>

<pre>argument &gt;&gt; str(&#39;,&#39;) &gt;&gt; arguments | argument</pre>

<p>}</p>

<p>rule(:argument) {</p>

<pre>call | identifier</pre>

<p>}</p>

<p>and the following source:</p>

<pre>foo.bar(a,goo.baz(),c,)</pre>

<p>The contextual reporter returns the following causes:</p>

<p>0: Failed to match sequence (identifier &#39;.&#39; method call) at line 1
char 5</p>

<pre>when parsing method call arguments.</pre>

<p>1: Failed to match sequence (identifier &#39;(&#39; method call arguments?
&#39;)&#39;) at</p>

<pre>line 1 char 22 when parsing method call arguments.</pre>

<p>2: Failed to match [[:alnum:]] at line 1 char 23 when parsing method call</p>

<pre>arguments.</pre>

<p>(where 2 is a child cause of 1 and 1 a child cause of 0)</p>

<p>The last piece used by the reporter is the (newly introduced) ability to
attach a label to rules that describe a sequence in the grammar. The labels
are used in two places:</p>

<pre>- In the &quot;to_s&quot; of Atom::Base so that any error message uses labels to
  refer to atoms
- In the cause error messages to give information about which expression
  failed to parse</pre>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/parslet/error_reporter/contextual.rb, line 59</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>
  <span class="ruby-ivar">@last_reset_pos</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">reset</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-err" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">err</span><span
            class="method-args">(atom, source, message, children=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Produces an error cause that combines the message at the current level with
the errors that happened at a level below (children). Compute and set label
used by <a href="../Cause.html">Cause</a> to produce error message.</p>

<p>@param atom [Parslet::Atoms::Base] parslet that failed @param source
[Source] <a href="../Source.html">Source</a> that we&#39;re using for this
parse. (line</p>

<pre>number information...)</pre>

<p>@param message [String, Array] Error message at this level. @param children
[Array] A list of errors from a deeper level (or nil). @return [Cause] An
error tree combining children with message.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="err-source">
            <pre><span class="ruby-comment"># File lib/parslet/error_reporter/contextual.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">err</span>(<span class="ruby-identifier">atom</span>, <span class="ruby-identifier">source</span>, <span class="ruby-identifier">message</span>, <span class="ruby-identifier">children</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">cause</span> = <span class="ruby-keyword">super</span>(<span class="ruby-identifier">atom</span>, <span class="ruby-identifier">source</span>, <span class="ruby-identifier">message</span>, <span class="ruby-identifier">children</span>)
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">label</span> = <span class="ruby-identifier">atom</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:label</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">atom</span>.<span class="ruby-identifier">label</span>)
    <span class="ruby-identifier">update_label</span>(<span class="ruby-identifier">label</span>, <span class="ruby-identifier">source</span>.<span class="ruby-identifier">pos</span>.<span class="ruby-identifier">bytepos</span>)
    <span class="ruby-identifier">cause</span>.<span class="ruby-identifier">set_label</span>(<span class="ruby-ivar">@label</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">cause</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- err-source -->
          
        </div>

        

        
      </div><!-- err-method -->

    
      <div id="method-i-reset" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reset deepest error and its position and sequence index</p>
          
          

          
          <div class="method-source-code" id="reset-source">
            <pre><span class="ruby-comment"># File lib/parslet/error_reporter/contextual.rb, line 79</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset</span>
  <span class="ruby-ivar">@deepest_cause</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@label_pos</span> = <span class="ruby-value">-1</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- reset-source -->
          
        </div>

        

        
      </div><!-- reset-method -->

    
      <div id="method-i-succ" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">succ</span><span
            class="method-args">(source)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>A sequence expression successfully parsed, reset all errors reported for
previous expressions in the sequence (an alternative matched) Only reset
errors if the position of the source that matched is higher than the
position of the source that was last successful (so we keep errors that are
the “deepest” but for which no alternative succeeded)</p>
          
          

          
          <div class="method-source-code" id="succ-source">
            <pre><span class="ruby-comment"># File lib/parslet/error_reporter/contextual.rb, line 70</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">succ</span>(<span class="ruby-identifier">source</span>)
  <span class="ruby-identifier">source_pos</span> = <span class="ruby-identifier">source</span>.<span class="ruby-identifier">pos</span>.<span class="ruby-identifier">bytepos</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">source_pos</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@last_reset_pos</span>
  <span class="ruby-ivar">@last_reset_pos</span> = <span class="ruby-identifier">source_pos</span>
  <span class="ruby-identifier">reset</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- succ-source -->
          
        </div>

        

        
      </div><!-- succ-method -->

    
      <div id="method-i-update_label" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_label</span><span
            class="method-args">(label, bytepos)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Update error message label if given label is more relevant. A label is more
relevant if the position of the matched source is bigger.</p>

<p>@param label [String] label to apply if more relevant @param bytepos
[Integer] position in source code of matched source</p>
          
          

          
          <div class="method-source-code" id="update_label-source">
            <pre><span class="ruby-comment"># File lib/parslet/error_reporter/contextual.rb, line 111</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_label</span>(<span class="ruby-identifier">label</span>, <span class="ruby-identifier">bytepos</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">bytepos</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@label_pos</span>
    <span class="ruby-ivar">@label_pos</span> = <span class="ruby-identifier">bytepos</span>
    <span class="ruby-ivar">@label</span> = <span class="ruby-identifier">label</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_label-source -->
          
        </div>

        

        
      </div><!-- update_label-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 4.0.0.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

