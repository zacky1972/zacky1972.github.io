<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class Kramdown::Parser::Kramdown - kramdown-1.6.0 Documentation</title>

<link type="text/css" media="screen" href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../../index.html">Home</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  

  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/kramdown/parser/kramdown.rb
    <li>lib/kramdown/parser/kramdown/abbreviation.rb
    <li>lib/kramdown/parser/kramdown/autolink.rb
    <li>lib/kramdown/parser/kramdown/blank_line.rb
    <li>lib/kramdown/parser/kramdown/block_boundary.rb
    <li>lib/kramdown/parser/kramdown/blockquote.rb
    <li>lib/kramdown/parser/kramdown/codeblock.rb
    <li>lib/kramdown/parser/kramdown/codespan.rb
    <li>lib/kramdown/parser/kramdown/emphasis.rb
    <li>lib/kramdown/parser/kramdown/eob.rb
    <li>lib/kramdown/parser/kramdown/escaped_chars.rb
    <li>lib/kramdown/parser/kramdown/extensions.rb
    <li>lib/kramdown/parser/kramdown/footnote.rb
    <li>lib/kramdown/parser/kramdown/header.rb
    <li>lib/kramdown/parser/kramdown/horizontal_rule.rb
    <li>lib/kramdown/parser/kramdown/html.rb
    <li>lib/kramdown/parser/kramdown/html_entity.rb
    <li>lib/kramdown/parser/kramdown/line_break.rb
    <li>lib/kramdown/parser/kramdown/link.rb
    <li>lib/kramdown/parser/kramdown/list.rb
    <li>lib/kramdown/parser/kramdown/math.rb
    <li>lib/kramdown/parser/kramdown/paragraph.rb
    <li>lib/kramdown/parser/kramdown/smart_quotes.rb
    <li>lib/kramdown/parser/kramdown/table.rb
    <li>lib/kramdown/parser/kramdown/typographic_symbol.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="Base.html">Kramdown::Parser::Base</a>
  
</nav>

    <!-- Included Modules -->
<nav id="includes-section" class="section">
  <h3 class="section-header">Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="../../Kramdown.html">Kramdown</a>
  
  
  
    <li><a class="include" href="Html/Parser.html">Kramdown::Parser::Html::Parser</a>
  
  
  </ul>
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li ><a href="#method-c-define_parser">::define_parser</a>
    
    <li ><a href="#method-c-has_parser-3F">::has_parser?</a>
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-c-parser">::parser</a>
    
    <li ><a href="#method-i-add_link">#add_link</a>
    
    <li ><a href="#method-i-after_block_boundary-3F">#after_block_boundary?</a>
    
    <li ><a href="#method-i-before_block_boundary-3F">#before_block_boundary?</a>
    
    <li ><a href="#method-i-configure_parser">#configure_parser</a>
    
    <li ><a href="#method-i-correct_abbreviations_attributes">#correct_abbreviations_attributes</a>
    
    <li ><a href="#method-i-handle_extension">#handle_extension</a>
    
    <li ><a href="#method-i-handle_kramdown_html_tag">#handle_kramdown_html_tag</a>
    
    <li ><a href="#method-i-new_block_el">#new_block_el</a>
    
    <li ><a href="#method-i-normalize_link_id">#normalize_link_id</a>
    
    <li ><a href="#method-i-parse">#parse</a>
    
    <li ><a href="#method-i-parse_abbrev_definition">#parse_abbrev_definition</a>
    
    <li ><a href="#method-i-parse_attribute_list">#parse_attribute_list</a>
    
    <li ><a href="#method-i-parse_atx_header">#parse_atx_header</a>
    
    <li ><a href="#method-i-parse_autolink">#parse_autolink</a>
    
    <li ><a href="#method-i-parse_blank_line">#parse_blank_line</a>
    
    <li ><a href="#method-i-parse_block_extensions">#parse_block_extensions</a>
    
    <li ><a href="#method-i-parse_block_html">#parse_block_html</a>
    
    <li ><a href="#method-i-parse_block_math">#parse_block_math</a>
    
    <li ><a href="#method-i-parse_blockquote">#parse_blockquote</a>
    
    <li ><a href="#method-i-parse_blocks">#parse_blocks</a>
    
    <li ><a href="#method-i-parse_codeblock">#parse_codeblock</a>
    
    <li ><a href="#method-i-parse_codeblock_fenced">#parse_codeblock_fenced</a>
    
    <li ><a href="#method-i-parse_codespan">#parse_codespan</a>
    
    <li ><a href="#method-i-parse_definition_list">#parse_definition_list</a>
    
    <li ><a href="#method-i-parse_emphasis">#parse_emphasis</a>
    
    <li ><a href="#method-i-parse_eob_marker">#parse_eob_marker</a>
    
    <li ><a href="#method-i-parse_escaped_chars">#parse_escaped_chars</a>
    
    <li ><a href="#method-i-parse_extension_start_tag">#parse_extension_start_tag</a>
    
    <li ><a href="#method-i-parse_first_list_line">#parse_first_list_line</a>
    
    <li ><a href="#method-i-parse_footnote_definition">#parse_footnote_definition</a>
    
    <li ><a href="#method-i-parse_footnote_marker">#parse_footnote_marker</a>
    
    <li ><a href="#method-i-parse_horizontal_rule">#parse_horizontal_rule</a>
    
    <li ><a href="#method-i-parse_html_entity">#parse_html_entity</a>
    
    <li ><a href="#method-i-parse_inline_math">#parse_inline_math</a>
    
    <li ><a href="#method-i-parse_line_break">#parse_line_break</a>
    
    <li ><a href="#method-i-parse_link">#parse_link</a>
    
    <li ><a href="#method-i-parse_link_definition">#parse_link_definition</a>
    
    <li ><a href="#method-i-parse_list">#parse_list</a>
    
    <li ><a href="#method-i-parse_paragraph">#parse_paragraph</a>
    
    <li ><a href="#method-i-parse_setext_header">#parse_setext_header</a>
    
    <li ><a href="#method-i-parse_smart_quotes">#parse_smart_quotes</a>
    
    <li ><a href="#method-i-parse_span_extensions">#parse_span_extensions</a>
    
    <li ><a href="#method-i-parse_span_html">#parse_span_html</a>
    
    <li ><a href="#method-i-parse_spans">#parse_spans</a>
    
    <li ><a href="#method-i-parse_table">#parse_table</a>
    
    <li ><a href="#method-i-parse_typographic_syms">#parse_typographic_syms</a>
    
    <li ><a href="#method-i-replace_abbreviations">#replace_abbreviations</a>
    
    <li ><a href="#method-i-reset_env">#reset_env</a>
    
    <li ><a href="#method-i-restore_env">#restore_env</a>
    
    <li ><a href="#method-i-save_env">#save_env</a>
    
    <li ><a href="#method-i-span_parser_regexps">#span_parser_regexps</a>
    
    <li ><a href="#method-i-update_attr_with_ial">#update_attr_with_ial</a>
    
    <li ><a href="#method-i-update_ial_with_ial">#update_ial_with_ial</a>
    
    <li ><a href="#method-i-update_link_definitions">#update_link_definitions</a>
    
    <li ><a href="#method-i-update_raw_header_text">#update_raw_header_text</a>
    
    <li ><a href="#method-i-update_tree">#update_tree</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    
    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../../Kramdown.html">Kramdown</a>
  
    <li><a href="../../Kramdown/Converter.html">Kramdown::Converter</a>
  
    <li><a href="../../Kramdown/Converter/Base.html">Kramdown::Converter::Base</a>
  
    <li><a href="../../Kramdown/Converter/Html.html">Kramdown::Converter::Html</a>
  
    <li><a href="../../Kramdown/Converter/Kramdown.html">Kramdown::Converter::Kramdown</a>
  
    <li><a href="../../Kramdown/Converter/Latex.html">Kramdown::Converter::Latex</a>
  
    <li><a href="../../Kramdown/Converter/MathEngine.html">Kramdown::Converter::MathEngine</a>
  
    <li><a href="../../Kramdown/Converter/MathEngine/Itex2MML.html">Kramdown::Converter::MathEngine::Itex2MML</a>
  
    <li><a href="../../Kramdown/Converter/MathEngine/Mathjax.html">Kramdown::Converter::MathEngine::Mathjax</a>
  
    <li><a href="../../Kramdown/Converter/MathEngine/Ritex.html">Kramdown::Converter::MathEngine::Ritex</a>
  
    <li><a href="../../Kramdown/Converter/Pdf.html">Kramdown::Converter::Pdf</a>
  
    <li><a href="../../Kramdown/Converter/Pdf/PrawnDocumentExtension.html">Kramdown::Converter::Pdf::PrawnDocumentExtension</a>
  
    <li><a href="../../Kramdown/Converter/Pdf/PrawnDocumentExtension/CustomBox.html">Kramdown::Converter::Pdf::PrawnDocumentExtension::CustomBox</a>
  
    <li><a href="../../Kramdown/Converter/Pdf/PrawnDocumentExtension/Prawn.html">Kramdown::Converter::Pdf::PrawnDocumentExtension::Prawn</a>
  
    <li><a href="../../Kramdown/Converter/Pdf/PrawnDocumentExtension/Prawn/Text.html">Kramdown::Converter::Pdf::PrawnDocumentExtension::Prawn::Text</a>
  
    <li><a href="../../Kramdown/Converter/Pdf/PrawnDocumentExtension/Prawn/Text/Formatted.html">Kramdown::Converter::Pdf::PrawnDocumentExtension::Prawn::Text::Formatted</a>
  
    <li><a href="../../Kramdown/Converter/RemoveHtmlTags.html">Kramdown::Converter::RemoveHtmlTags</a>
  
    <li><a href="../../Kramdown/Converter/SyntaxHighlighter.html">Kramdown::Converter::SyntaxHighlighter</a>
  
    <li><a href="../../Kramdown/Converter/SyntaxHighlighter/Coderay.html">Kramdown::Converter::SyntaxHighlighter::Coderay</a>
  
    <li><a href="../../Kramdown/Converter/SyntaxHighlighter/Rouge.html">Kramdown::Converter::SyntaxHighlighter::Rouge</a>
  
    <li><a href="../../Kramdown/Converter/Toc.html">Kramdown::Converter::Toc</a>
  
    <li><a href="../../Kramdown/Document.html">Kramdown::Document</a>
  
    <li><a href="../../Kramdown/Element.html">Kramdown::Element</a>
  
    <li><a href="../../Kramdown/Error.html">Kramdown::Error</a>
  
    <li><a href="../../Kramdown/Options.html">Kramdown::Options</a>
  
    <li><a href="../../Kramdown/Options/Boolean.html">Kramdown::Options::Boolean</a>
  
    <li><a href="../../Kramdown/Parser.html">Kramdown::Parser</a>
  
    <li><a href="../../Kramdown/Parser/Base.html">Kramdown::Parser::Base</a>
  
    <li><a href="../../Kramdown/Parser/GFM.html">Kramdown::Parser::GFM</a>
  
    <li><a href="../../Kramdown/Parser/Html.html">Kramdown::Parser::Html</a>
  
    <li><a href="../../Kramdown/Parser/Html/Constants.html">Kramdown::Parser::Html::Constants</a>
  
    <li><a href="../../Kramdown/Parser/Html/ElementConverter.html">Kramdown::Parser::Html::ElementConverter</a>
  
    <li><a href="../../Kramdown/Parser/Html/Parser.html">Kramdown::Parser::Html::Parser</a>
  
    <li><a href="../../Kramdown/Parser/Kramdown.html">Kramdown::Parser::Kramdown</a>
  
    <li><a href="../../Kramdown/Parser/Markdown.html">Kramdown::Parser::Markdown</a>
  
    <li><a href="../../Kramdown/Utils.html">Kramdown::Utils</a>
  
    <li><a href="../../Kramdown/Utils/Configurable.html">Kramdown::Utils::Configurable</a>
  
    <li><a href="../../Kramdown/Utils/Entities.html">Kramdown::Utils::Entities</a>
  
    <li><a href="../../Kramdown/Utils/Entities/Entity.html">Kramdown::Utils::Entities::Entity</a>
  
    <li><a href="../../Kramdown/Utils/Html.html">Kramdown::Utils::Html</a>
  
    <li><a href="../../Kramdown/Utils/OrderedHash.html">Kramdown::Utils::OrderedHash</a>
  
    <li><a href="../../Kramdown/Utils/StringScanner.html">Kramdown::Utils::StringScanner</a>
  
    <li><a href="../../Kramdown/Utils/Unidecoder.html">Kramdown::Utils::Unidecoder</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Kramdown::Parser::Kramdown</h1>

  <div id="description" class="description">
    
<p>Used for parsing a document in kramdown format.</p>

<p>If you want to extend the functionality of the parser, you need to do the
following:</p>
<ul><li>
<p>Create a new subclass</p>
</li><li>
<p>add the needed parser methods</p>
</li><li>
<p>modify the @block_parsers and @span_parsers variables and add the names of
your parser methods</p>
</li></ul>

<p>Here is a small example for an extended parser class that parses ERB style
tags as raw text if they are used as span-level elements (an equivalent
block-level parser should probably also be made to handle the block case):</p>

<pre>require &#39;kramdown/parser/kramdown&#39;

class Kramdown::Parser::ERBKramdown &lt; Kramdown::Parser::Kramdown

   def initialize(source, options)
     super
     @span_parsers.unshift(:erb_tags)
   end

   ERB_TAGS_START = /&lt;%.*?%&gt;/

   def parse_erb_tags
     @src.pos += @src.matched_size
     @tree.children &lt;&lt; Element.new(:raw, @src.matched)
   end
   define_parser(:erb_tags, ERB_TAGS_START, &#39;&lt;%&#39;)

end</pre>

<p>The new parser can be used like this:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;kramdown/document&#39;</span>
<span class="ruby-comment"># require the file with the above parser class</span>

<span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">input_text</span>, :<span class="ruby-identifier">input</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;ERBKramdown&#39;</span>).<span class="ruby-identifier">to_html</span>
</pre>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="ABBREV_DEFINITION_START">ABBREV_DEFINITION_START
        
        <dd class="description">
        
      
        <dt id="ACHARS">ACHARS
        
        <dd class="description">
        
      
        <dt id="ALD_ANY_CHARS">ALD_ANY_CHARS
        
        <dd class="description">
        
      
        <dt id="ALD_ID_CHARS">ALD_ID_CHARS
        
        <dd class="description">
        
      
        <dt id="ALD_ID_NAME">ALD_ID_NAME
        
        <dd class="description">
        
      
        <dt id="ALD_START">ALD_START
        
        <dd class="description">
        
      
        <dt id="ALD_TYPE_ANY">ALD_TYPE_ANY
        
        <dd class="description">
        
      
        <dt id="ALD_TYPE_CLASS_NAME">ALD_TYPE_CLASS_NAME
        
        <dd class="description">
        
      
        <dt id="ALD_TYPE_ID_NAME">ALD_TYPE_ID_NAME
        
        <dd class="description">
        
      
        <dt id="ALD_TYPE_ID_OR_CLASS">ALD_TYPE_ID_OR_CLASS
        
        <dd class="description">
        
      
        <dt id="ALD_TYPE_ID_OR_CLASS_MULTI">ALD_TYPE_ID_OR_CLASS_MULTI
        
        <dd class="description">
        
      
        <dt id="ALD_TYPE_KEY_VALUE_PAIR">ALD_TYPE_KEY_VALUE_PAIR
        
        <dd class="description">
        
      
        <dt id="ALD_TYPE_REF">ALD_TYPE_REF
        
        <dd class="description">
        
      
        <dt id="ATX_HEADER_MATCH">ATX_HEADER_MATCH
        
        <dd class="description">
        
      
        <dt id="ATX_HEADER_START">ATX_HEADER_START
        
        <dd class="description">
        
      
        <dt id="AUTOLINK_START">AUTOLINK_START
        
        <dd class="description">
        
      
        <dt id="AUTOLINK_START_STR">AUTOLINK_START_STR
        
        <dd class="description">
        
      
        <dt id="BLANK_LINE">BLANK_LINE
        
        <dd class="description">
        
      
        <dt id="BLOCKQUOTE_START">BLOCKQUOTE_START
        
        <dd class="description">
        
      
        <dt id="BLOCK_BOUNDARY">BLOCK_BOUNDARY
        
        <dd class="description">
        
      
        <dt id="BLOCK_EXTENSIONS_START">BLOCK_EXTENSIONS_START
        
        <dd class="description">
        
      
        <dt id="BLOCK_MATH_START">BLOCK_MATH_START
        
        <dd class="description">
        
      
        <dt id="CODEBLOCK_MATCH">CODEBLOCK_MATCH
        
        <dd class="description">
        
      
        <dt id="CODEBLOCK_START">CODEBLOCK_START
        
        <dd class="description">
        
      
        <dt id="CODESPAN_DELIMITER">CODESPAN_DELIMITER
        
        <dd class="description">
        
      
        <dt id="DEFINITION_LIST_START">DEFINITION_LIST_START
        
        <dd class="description">
        
      
        <dt id="Data">Data
        
        <dd class="description"><p>Struct class holding all the needed data for one block/span-level parser
method.</p>
        
      
        <dt id="EMPHASIS_START">EMPHASIS_START
        
        <dd class="description">
        
      
        <dt id="EOB_MARKER">EOB_MARKER
        
        <dd class="description">
        
      
        <dt id="ESCAPED_CHARS">ESCAPED_CHARS
        
        <dd class="description">
        
      
        <dt id="EXT_BLOCK_START">EXT_BLOCK_START
        
        <dd class="description">
        
      
        <dt id="EXT_BLOCK_STOP_STR">EXT_BLOCK_STOP_STR
        
        <dd class="description">
        
      
        <dt id="EXT_SPAN_START">EXT_SPAN_START
        
        <dd class="description">
        
      
        <dt id="EXT_START_STR">EXT_START_STR
        
        <dd class="description">
        
      
        <dt id="EXT_STOP_STR">EXT_STOP_STR
        
        <dd class="description">
        
      
        <dt id="FENCED_CODEBLOCK_MATCH">FENCED_CODEBLOCK_MATCH
        
        <dd class="description">
        
      
        <dt id="FENCED_CODEBLOCK_START">FENCED_CODEBLOCK_START
        
        <dd class="description">
        
      
        <dt id="FOOTNOTE_DEFINITION_START">FOOTNOTE_DEFINITION_START
        
        <dd class="description">
        
      
        <dt id="FOOTNOTE_MARKER_START">FOOTNOTE_MARKER_START
        
        <dd class="description">
        
      
        <dt id="HEADER_ID">HEADER_ID
        
        <dd class="description">
        
      
        <dt id="HR_START">HR_START
        
        <dd class="description">
        
      
        <dt id="HTML_BLOCK_START">HTML_BLOCK_START
        
        <dd class="description">
        
      
        <dt id="HTML_MARKDOWN_ATTR_MAP">HTML_MARKDOWN_ATTR_MAP
        
        <dd class="description"><p>Mapping of markdown attribute value to content model. I.e. :raw when “0”,
:default when “1” (use default content model for the HTML element), :span
when “span”, :block when block and for everything else <code>nil</code> is
returned.</p>
        
      
        <dt id="HTML_SPAN_START">HTML_SPAN_START
        
        <dd class="description">
        
      
        <dt id="IAL_BLOCK">IAL_BLOCK
        
        <dd class="description">
        
      
        <dt id="IAL_BLOCK_START">IAL_BLOCK_START
        
        <dd class="description">
        
      
        <dt id="IAL_CLASS_ATTR">IAL_CLASS_ATTR
        
        <dd class="description">
        
      
        <dt id="IAL_SPAN_START">IAL_SPAN_START
        
        <dd class="description">
        
      
        <dt id="INDENT">INDENT
        
        <dd class="description"><p>Regexp for matching indentation (one tab or four spaces)</p>
        
      
        <dt id="INLINE_MATH_START">INLINE_MATH_START
        
        <dd class="description">
        
      
        <dt id="LAZY_END">LAZY_END
        
        <dd class="description">
        
      
        <dt id="LAZY_END_HTML_SPAN_ELEMENTS">LAZY_END_HTML_SPAN_ELEMENTS
        
        <dd class="description">
        
      
        <dt id="LAZY_END_HTML_START">LAZY_END_HTML_START
        
        <dd class="description">
        
      
        <dt id="LAZY_END_HTML_STOP">LAZY_END_HTML_STOP
        
        <dd class="description">
        
      
        <dt id="LINE_BREAK">LINE_BREAK
        
        <dd class="description">
        
      
        <dt id="LINK_BRACKET_STOP_RE">LINK_BRACKET_STOP_RE
        
        <dd class="description">
        
      
        <dt id="LINK_DEFINITION_START">LINK_DEFINITION_START
        
        <dd class="description">
        
      
        <dt id="LINK_INLINE_ID_RE">LINK_INLINE_ID_RE
        
        <dd class="description">
        
      
        <dt id="LINK_INLINE_TITLE_RE">LINK_INLINE_TITLE_RE
        
        <dd class="description">
        
      
        <dt id="LINK_PAREN_STOP_RE">LINK_PAREN_STOP_RE
        
        <dd class="description">
        
      
        <dt id="LINK_START">LINK_START
        
        <dd class="description">
        
      
        <dt id="LIST_ITEM_IAL">LIST_ITEM_IAL
        
        <dd class="description">
        
      
        <dt id="LIST_ITEM_IAL_CHECK">LIST_ITEM_IAL_CHECK
        
        <dd class="description">
        
      
        <dt id="LIST_START">LIST_START
        
        <dd class="description">
        
      
        <dt id="LIST_START_OL">LIST_START_OL
        
        <dd class="description">
        
      
        <dt id="LIST_START_UL">LIST_START_UL
        
        <dd class="description">
        
      
        <dt id="OPT_SPACE">OPT_SPACE
        
        <dd class="description"><p>Regexp for matching the optional space (zero or up to three spaces)</p>
        
      
        <dt id="PARAGRAPH_END">PARAGRAPH_END
        
        <dd class="description">
        
      
        <dt id="PARAGRAPH_MATCH">PARAGRAPH_MATCH
        
        <dd class="description">
        
      
        <dt id="PARAGRAPH_START">PARAGRAPH_START
        
        <dd class="description">
        
      
        <dt id="PARSE_FIRST_LIST_LINE_REGEXP_CACHE">PARSE_FIRST_LIST_LINE_REGEXP_CACHE
        
        <dd class="description">
        
      
        <dt id="SETEXT_HEADER_START">SETEXT_HEADER_START
        
        <dd class="description">
        
      
        <dt id="SMART_QUOTES_RE">SMART_QUOTES_RE
        
        <dd class="description">
        
      
        <dt id="SPAN_EXTENSIONS_START">SPAN_EXTENSIONS_START
        
        <dd class="description">
        
      
        <dt id="SQ_CLOSE">SQ_CLOSE
        
        <dd class="description">
        
      
        <dt id="SQ_PUNCT">SQ_PUNCT
        
        <dd class="description">
        
      
        <dt id="SQ_RULES">SQ_RULES
        
        <dd class="description">
        
      
        <dt id="SQ_SUBSTS">SQ_SUBSTS
        
        <dd class="description">
        
      
        <dt id="TABLE_FSEP_LINE">TABLE_FSEP_LINE
        
        <dd class="description">
        
      
        <dt id="TABLE_HSEP_ALIGN">TABLE_HSEP_ALIGN
        
        <dd class="description">
        
      
        <dt id="TABLE_LINE">TABLE_LINE
        
        <dd class="description">
        
      
        <dt id="TABLE_PIPE_CHECK">TABLE_PIPE_CHECK
        
        <dd class="description">
        
      
        <dt id="TABLE_ROW_LINE">TABLE_ROW_LINE
        
        <dd class="description">
        
      
        <dt id="TABLE_SEP_LINE">TABLE_SEP_LINE
        
        <dd class="description">
        
      
        <dt id="TABLE_START">TABLE_START
        
        <dd class="description">
        
      
        <dt id="TRAILING_WHITESPACE">TRAILING_WHITESPACE
        
        <dd class="description">
        
      
        <dt id="TYPOGRAPHIC_SYMS">TYPOGRAPHIC_SYMS
        
        <dd class="description">
        
      
        <dt id="TYPOGRAPHIC_SYMS_RE">TYPOGRAPHIC_SYMS_RE
        
        <dd class="description">
        
      
        <dt id="TYPOGRAPHIC_SYMS_SUBST">TYPOGRAPHIC_SYMS_SUBST
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="protected-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Protected Class Methods</h3>

    
      <div id="method-c-define_parser" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">define_parser</span><span
            class="method-args">(name, start_re, span_start = nil, meth_name = "parse_</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add a parser method</p>
<ul><li>
<p>with the given <code>name</code>,</p>
</li><li>
<p>using <code>start_re</code> as start regexp</p>
</li><li>
<p>and, for span parsers, <code>span_start</code> as a String that can be used
in a regexp and which identifies the starting character(s)</p>
</li></ul>

<p>to the registry. The method name is automatically derived from the
<code>name</code> or can explicitly be set by using the
<code>meth_name</code> parameter.</p>
          
          

          
          <div class="method-source-code" id="define_parser-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 313</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">define_parser</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">start_re</span>, <span class="ruby-identifier">span_start</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">meth_name</span> = <span class="ruby-node">&quot;parse_#{name}&quot;</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;A parser with the name #{name} already exists!&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">@@parsers</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-identifier">@@parsers</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-constant">Data</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">start_re</span>, <span class="ruby-identifier">span_start</span>, <span class="ruby-identifier">meth_name</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- define_parser-source -->
          
        </div>

        

        
      </div><!-- define_parser-method -->

    
      <div id="method-c-has_parser-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">has_parser?</span><span
            class="method-args">(name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return <code>true</code> if there is a parser called <code>name</code>.</p>
          
          

          
          <div class="method-source-code" id="has_parser-3F-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 324</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">has_parser?</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-identifier">@@parsers</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">name</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- has_parser-3F-source -->
          
        </div>

        

        
      </div><!-- has_parser-3F-method -->

    
      <div id="method-c-parser" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parser</span><span
            class="method-args">(name = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return the <a href="Kramdown.html#Data">Data</a> structure for the parser
<code>name</code>.</p>
          
          

          
          <div class="method-source-code" id="parser-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 319</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">parser</span>(<span class="ruby-identifier">name</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">@@parsers</span>[<span class="ruby-identifier">name</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- parser-source -->
          
        </div>

        

        
      </div><!-- parser-method -->

    
    </section><!-- protected-class-method-details -->
  
     <section id="private-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Private Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(source, options)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Create a new <a href="Kramdown.html">Kramdown</a> parser object with the
given <code>options</code>.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Base.html#method-c-new">Kramdown::Parser::Base.new</a>
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 64</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-keyword">super</span>

  <span class="ruby-identifier">reset_env</span>

  <span class="ruby-ivar">@alds</span> = {}
  <span class="ruby-ivar">@footnotes</span> = {}
  <span class="ruby-ivar">@link_defs</span> = {}
  <span class="ruby-identifier">update_link_definitions</span>(<span class="ruby-ivar">@options</span>[<span class="ruby-value">:link_defs</span>])

  <span class="ruby-ivar">@block_parsers</span> = [<span class="ruby-value">:blank_line</span>, <span class="ruby-value">:codeblock</span>, <span class="ruby-value">:codeblock_fenced</span>, <span class="ruby-value">:blockquote</span>, <span class="ruby-value">:atx_header</span>,
                    <span class="ruby-value">:horizontal_rule</span>, <span class="ruby-value">:list</span>, <span class="ruby-value">:definition_list</span>, <span class="ruby-value">:block_html</span>, <span class="ruby-value">:setext_header</span>,
                    <span class="ruby-value">:block_math</span>, <span class="ruby-value">:table</span>, <span class="ruby-value">:footnote_definition</span>, <span class="ruby-value">:link_definition</span>, <span class="ruby-value">:abbrev_definition</span>,
                    <span class="ruby-value">:block_extensions</span>, <span class="ruby-value">:eob_marker</span>, <span class="ruby-value">:paragraph</span>]
  <span class="ruby-ivar">@span_parsers</span> =  [<span class="ruby-value">:emphasis</span>, <span class="ruby-value">:codespan</span>, <span class="ruby-value">:autolink</span>, <span class="ruby-value">:span_html</span>, <span class="ruby-value">:footnote_marker</span>, <span class="ruby-value">:link</span>, <span class="ruby-value">:smart_quotes</span>, <span class="ruby-value">:inline_math</span>,
                   <span class="ruby-value">:span_extensions</span>, <span class="ruby-value">:html_entity</span>, <span class="ruby-value">:typographic_syms</span>, <span class="ruby-value">:line_break</span>, <span class="ruby-value">:escaped_chars</span>]

<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(source, options)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Initialize the parser object with the <code>source</code> string and the
parsing <code>options</code>.</p>

<p>The @root element, the @warnings array and @text_type (specifies the
default type for newly created text nodes) are automatically initialized.</p>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/base.rb, line 51</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-ivar">@source</span> = <span class="ruby-identifier">source</span>
  <span class="ruby-ivar">@options</span> = <span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-ivar">@root</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:root</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:encoding</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">source</span>.<span class="ruby-identifier">encoding</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>), <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>,
                      <span class="ruby-value">:options</span> =<span class="ruby-operator">&gt;</span> {}, <span class="ruby-value">:abbrev_defs</span> =<span class="ruby-operator">&gt;</span> {}, <span class="ruby-value">:abbrev_attr</span> =<span class="ruby-operator">&gt;</span> {})
  <span class="ruby-ivar">@warnings</span> = []
  <span class="ruby-ivar">@text_type</span> = <span class="ruby-value">:text</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- private-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-add_link" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_link</span><span
            class="method-args">(el, href, title, alt_text = nil, ial = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This helper methods adds the approriate attributes to the element
<code>el</code> of type <code>a</code> or <code>img</code> and the element
itself to the @tree.</p>
          
          

          
          <div class="method-source-code" id="add_link-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/link.rb, line 36</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_link</span>(<span class="ruby-identifier">el</span>, <span class="ruby-identifier">href</span>, <span class="ruby-identifier">title</span>, <span class="ruby-identifier">alt_text</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">ial</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">el</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>] = <span class="ruby-identifier">ial</span>
  <span class="ruby-identifier">update_attr_with_ial</span>(<span class="ruby-identifier">el</span>.<span class="ruby-identifier">attr</span>, <span class="ruby-identifier">ial</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">ial</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:a</span>
    <span class="ruby-identifier">el</span>.<span class="ruby-identifier">attr</span>[<span class="ruby-string">&#39;href&#39;</span>] = <span class="ruby-identifier">href</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">el</span>.<span class="ruby-identifier">attr</span>[<span class="ruby-string">&#39;src&#39;</span>] = <span class="ruby-identifier">href</span>
    <span class="ruby-identifier">el</span>.<span class="ruby-identifier">attr</span>[<span class="ruby-string">&#39;alt&#39;</span>] = <span class="ruby-identifier">alt_text</span>
    <span class="ruby-identifier">el</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">el</span>.<span class="ruby-identifier">attr</span>[<span class="ruby-string">&#39;title&#39;</span>] = <span class="ruby-identifier">title</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">title</span>
  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">el</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_link-source -->
          
        </div>

        

        
      </div><!-- add_link-method -->

    
      <div id="method-i-after_block_boundary-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">after_block_boundary?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return <code>true</code> if we are after a block boundary.</p>
          
          

          
          <div class="method-source-code" id="after_block_boundary-3F-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/block_boundary.rb, line 20</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">after_block_boundary?</span>
  <span class="ruby-operator">!</span><span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:blank</span> <span class="ruby-operator">||</span>
    (<span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:eob</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">||</span> <span class="ruby-ivar">@block_ial</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- after_block_boundary-3F-source -->
          
        </div>

        

        
      </div><!-- after_block_boundary-3F-method -->

    
      <div id="method-i-before_block_boundary-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">before_block_boundary?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return <code>true</code> if we are before a block boundary.</p>
          
          

          
          <div class="method-source-code" id="before_block_boundary-3F-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/block_boundary.rb, line 26</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">before_block_boundary?</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">BLOCK_BOUNDARY</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- before_block_boundary-3F-source -->
          
        </div>

        

        
      </div><!-- before_block_boundary-3F-method -->

    
      <div id="method-i-correct_abbreviations_attributes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">correct_abbreviations_attributes</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Correct abbreviation attributes.</p>
          
          

          
          <div class="method-source-code" id="correct_abbreviations_attributes-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/abbreviation.rb, line 30</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">correct_abbreviations_attributes</span>
  <span class="ruby-ivar">@root</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:abbrev_attr</span>].<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@root</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:abbrev_attr</span>][<span class="ruby-identifier">k</span>] = <span class="ruby-ivar">@root</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:abbrev_attr</span>][<span class="ruby-identifier">k</span>].<span class="ruby-identifier">attr</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- correct_abbreviations_attributes-source -->
          
        </div>

        

        
      </div><!-- correct_abbreviations_attributes-method -->

    
      <div id="method-i-handle_extension" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">handle_extension</span><span
            class="method-args">(name, opts, body, type, line_no = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="handle_extension-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/extensions.rb, line 94</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">handle_extension</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">line_no</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">name</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;comment&#39;</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:comment</span>, <span class="ruby-identifier">body</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:category</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">type</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">line_no</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">String</span>)
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;nomarkdown&#39;</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:raw</span>, <span class="ruby-identifier">body</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:category</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">type</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">line_no</span>, <span class="ruby-value">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">opts</span>[<span class="ruby-string">&#39;type&#39;</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\s+/</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">String</span>)
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;options&#39;</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">k</span> = <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_sym</span>
      <span class="ruby-keyword">if</span> <span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Options</span>.<span class="ruby-identifier">defined?</span>(<span class="ruby-identifier">k</span>)
        <span class="ruby-keyword">begin</span>
          <span class="ruby-identifier">val</span> = <span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Options</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span>)
          <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">val</span>
          (<span class="ruby-ivar">@root</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:options</span>] <span class="ruby-operator">||=</span> {})[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">val</span>
        <span class="ruby-keyword">rescue</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;Unknown kramdown option &#39;#{k}&#39;&quot;</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:eob</span>, <span class="ruby-value">:extension</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block</span>
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- handle_extension-source -->
          
        </div>

        

        
      </div><!-- handle_extension-method -->

    
      <div id="method-i-handle_kramdown_html_tag" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">handle_kramdown_html_tag</span><span
            class="method-args">(el, closed, handle_body)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="handle_kramdown_html_tag-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/html.rb, line 24</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">handle_kramdown_html_tag</span>(<span class="ruby-identifier">el</span>, <span class="ruby-identifier">closed</span>, <span class="ruby-identifier">handle_body</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@block_ial</span>
    <span class="ruby-identifier">el</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>] = <span class="ruby-ivar">@block_ial</span>
    <span class="ruby-ivar">@block_ial</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">content_model</span> = <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:html_element</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:content_model</span>] <span class="ruby-operator">!=</span> <span class="ruby-value">:raw</span>
                    (<span class="ruby-ivar">@options</span>[<span class="ruby-value">:parse_block_html</span>] <span class="ruby-operator">?</span> <span class="ruby-constant">HTML_CONTENT_MODEL</span>[<span class="ruby-identifier">el</span>.<span class="ruby-identifier">value</span>] <span class="ruby-operator">:</span> <span class="ruby-value">:raw</span>)
                  <span class="ruby-keyword">else</span>
                    <span class="ruby-value">:raw</span>
                  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> = <span class="ruby-constant">HTML_MARKDOWN_ATTR_MAP</span>[<span class="ruby-identifier">el</span>.<span class="ruby-identifier">attr</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;markdown&#39;</span>)]
    <span class="ruby-identifier">content_model</span> = (<span class="ruby-identifier">val</span> <span class="ruby-operator">==</span> <span class="ruby-value">:default</span> <span class="ruby-operator">?</span> <span class="ruby-constant">HTML_CONTENT_MODEL</span>[<span class="ruby-identifier">el</span>.<span class="ruby-identifier">value</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">val</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">TRAILING_WHITESPACE</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">content_model</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block</span>
  <span class="ruby-identifier">el</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:content_model</span>] = <span class="ruby-identifier">content_model</span>
  <span class="ruby-identifier">el</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:is_closed</span>] = <span class="ruby-identifier">closed</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">closed</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">handle_body</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">content_model</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">parse_blocks</span>(<span class="ruby-identifier">el</span>)
        <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;Found no end tag for &#39;#{el.value}&#39; (line #{el.options[:location]}) - auto-closing it&quot;</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">content_model</span> <span class="ruby-operator">==</span> <span class="ruby-value">:span</span>
      <span class="ruby-identifier">curpos</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan_until</span>(<span class="ruby-node">/(?=&lt;\/#{el.value}\s*&gt;)/</span><span class="ruby-identifier">i</span>)
        <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">extract_string</span>(<span class="ruby-identifier">curpos</span><span class="ruby-operator">...</span><span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span>, <span class="ruby-ivar">@src</span>), <span class="ruby-identifier">el</span>)
        <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">HTML_TAG_CLOSE_RE</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">add_text</span>(<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">rest</span>, <span class="ruby-identifier">el</span>)
        <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">terminate</span>
        <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;Found no end tag for &#39;#{el.value}&#39; (line #{el.options[:location]}) - auto-closing it&quot;</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">parse_raw_html</span>(<span class="ruby-identifier">el</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-value">:handle_kramdown_html_tag</span>))
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">TRAILING_WHITESPACE</span>) <span class="ruby-keyword">unless</span> (<span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:html_element</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:content_model</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:raw</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- handle_kramdown_html_tag-source -->
          
        </div>

        

        
      </div><!-- handle_kramdown_html_tag-method -->

    
      <div id="method-i-normalize_link_id" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">normalize_link_id</span><span
            class="method-args">(id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Normalize the link identifier.</p>
          
          

          
          <div class="method-source-code" id="normalize_link_id-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/link.rb, line 16</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">normalize_link_id</span>(<span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">id</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/[\s]+/</span>, <span class="ruby-string">&#39; &#39;</span>).<span class="ruby-identifier">downcase</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- normalize_link_id-source -->
          
        </div>

        

        
      </div><!-- normalize_link_id-method -->

    
      <div id="method-i-parse" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The source string provided on initialization is parsed into the @root
element.</p>
          
          

          
          <div class="method-source-code" id="parse-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 86</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse</span>
  <span class="ruby-identifier">configure_parser</span>
  <span class="ruby-identifier">parse_blocks</span>(<span class="ruby-ivar">@root</span>, <span class="ruby-identifier">adapt_source</span>(<span class="ruby-identifier">source</span>))
  <span class="ruby-identifier">update_tree</span>(<span class="ruby-ivar">@root</span>)
  <span class="ruby-identifier">correct_abbreviations_attributes</span>
  <span class="ruby-identifier">replace_abbreviations</span>(<span class="ruby-ivar">@root</span>)
  <span class="ruby-ivar">@footnotes</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">name</span>,<span class="ruby-identifier">data</span><span class="ruby-operator">|</span> <span class="ruby-identifier">update_tree</span>(<span class="ruby-identifier">data</span>[<span class="ruby-value">:content</span>])}
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse-source -->
          
        </div>

        

        
      </div><!-- parse-method -->

    
      <div id="method-i-parse_abbrev_definition" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_abbrev_definition</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the link definition at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_abbrev_definition-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/abbreviation.rb, line 16</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_abbrev_definition</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
  <span class="ruby-identifier">abbrev_id</span>, <span class="ruby-identifier">abbrev_text</span> = <span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>], <span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>]
  <span class="ruby-identifier">abbrev_text</span>.<span class="ruby-identifier">strip!</span>
  <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;Duplicate abbreviation ID &#39;#{abbrev_id}&#39; on line #{start_line_number} - overwriting&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@root</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:abbrev_defs</span>][<span class="ruby-identifier">abbrev_id</span>]
  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:eob</span>, <span class="ruby-value">:abbrev_def</span>)
  <span class="ruby-ivar">@root</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:abbrev_defs</span>][<span class="ruby-identifier">abbrev_id</span>] = <span class="ruby-identifier">abbrev_text</span>
  <span class="ruby-ivar">@root</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:abbrev_attr</span>][<span class="ruby-identifier">abbrev_id</span>] = <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_abbrev_definition-source -->
          
        </div>

        

        
      </div><!-- parse_abbrev_definition-method -->

    
      <div id="method-i-parse_attribute_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_attribute_list</span><span
            class="method-args">(str, opts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the string <code>str</code> and extract all attributes and add all
found attributes to the hash <code>opts</code>.</p>
          
          

          
          <div class="method-source-code" id="parse_attribute_list-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/extensions.rb, line 17</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_attribute_list</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">opts</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">strip</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;:&#39;</span>
  <span class="ruby-identifier">attrs</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">ALD_TYPE_ANY</span>)
  <span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">sep</span>, <span class="ruby-identifier">val</span>, <span class="ruby-identifier">ref</span>, <span class="ruby-identifier">id_and_or_class</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">ref</span>
      (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:refs</span>] <span class="ruby-operator">||=</span> []) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ref</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">id_and_or_class</span>
      <span class="ruby-identifier">id_and_or_class</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">ALD_TYPE_ID_OR_CLASS</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">id_attr</span>, <span class="ruby-identifier">class_attr</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">class_attr</span>
          <span class="ruby-identifier">opts</span>[<span class="ruby-constant">IAL_CLASS_ATTR</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-constant">IAL_CLASS_ATTR</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; #{class_attr}&quot;</span>
          <span class="ruby-identifier">opts</span>[<span class="ruby-constant">IAL_CLASS_ATTR</span>].<span class="ruby-identifier">lstrip!</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">opts</span>[<span class="ruby-string">&#39;id&#39;</span>] = <span class="ruby-identifier">id_attr</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">val</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/\(\}|#{sep})/</span>, <span class="ruby-string">&quot;\\1&quot;</span>)
      <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">val</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;No or invalid attributes found in IAL/ALD content: #{str}&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_attribute_list-source -->
          
        </div>

        

        
      </div><!-- parse_attribute_list-method -->

    
      <div id="method-i-parse_atx_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_atx_header</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the Atx header at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_atx_header-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/header.rb, line 39</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_atx_header</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">after_block_boundary?</span>

  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-constant">ATX_HEADER_MATCH</span>)
  <span class="ruby-identifier">level</span>, <span class="ruby-identifier">text</span>, <span class="ruby-identifier">id</span> = <span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>], <span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>, <span class="ruby-ivar">@src</span>[<span class="ruby-value">3</span>]
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
  <span class="ruby-identifier">el</span> = <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:header</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:level</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">level</span>.<span class="ruby-identifier">length</span>, <span class="ruby-value">:raw_text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">text</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
  <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">el</span>)
  <span class="ruby-identifier">el</span>.<span class="ruby-identifier">attr</span>[<span class="ruby-string">&#39;id&#39;</span>] = <span class="ruby-identifier">id</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">id</span>
  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">el</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_atx_header-source -->
          
        </div>

        

        
      </div><!-- parse_atx_header-method -->

    
      <div id="method-i-parse_autolink" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_autolink</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the autolink at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_autolink-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/autolink.rb, line 24</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_autolink</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
  <span class="ruby-identifier">href</span> = (<span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-node">&quot;mailto:#{@src[1]}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>])
  <span class="ruby-identifier">el</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:a</span>, <span class="ruby-keyword">nil</span>, {<span class="ruby-string">&#39;href&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>}, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
  <span class="ruby-identifier">add_text</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/^mailto:/</span>, <span class="ruby-string">&#39;&#39;</span>), <span class="ruby-identifier">el</span>)
  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">el</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_autolink-source -->
          
        </div>

        

        
      </div><!-- parse_autolink-method -->

    
      <div id="method-i-parse_blank_line" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_blank_line</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the blank line at the current postition.</p>
          
          

          
          <div class="method-source-code" id="parse_blank_line-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/blank_line.rb, line 16</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_blank_line</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:blank</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:blank</span>, <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_blank_line-source -->
          
        </div>

        

        
      </div><!-- parse_blank_line-method -->

    
      <div id="method-i-parse_block_extensions" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_block_extensions</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse one of the block extensions (ALD, block IAL or generic extension) at
the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_block_extensions-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/extensions.rb, line 151</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_block_extensions</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">ALD_START</span>)
    <span class="ruby-identifier">parse_attribute_list</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>], <span class="ruby-ivar">@alds</span>[<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>]] <span class="ruby-operator">||=</span> <span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderedHash</span>.<span class="ruby-identifier">new</span>)
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:eob</span>, <span class="ruby-value">:ald</span>)
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-constant">EXT_BLOCK_START</span>)
    <span class="ruby-identifier">parse_extension_start_tag</span>(<span class="ruby-value">:block</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">IAL_BLOCK_START</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:blank</span> <span class="ruby-operator">&amp;&amp;</span>
        (<span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:eob</span> <span class="ruby-operator">||</span> [<span class="ruby-value">:link_def</span>, <span class="ruby-value">:abbrev_def</span>, <span class="ruby-value">:footnote_def</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">value</span>))
      <span class="ruby-identifier">parse_attribute_list</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>], <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderedHash</span>.<span class="ruby-identifier">new</span>)
      <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:eob</span>, <span class="ruby-value">:ial</span>) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-constant">IAL_BLOCK_START</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">parse_attribute_list</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>], <span class="ruby-ivar">@block_ial</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderedHash</span>.<span class="ruby-identifier">new</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_block_extensions-source -->
          
        </div>

        

        
      </div><!-- parse_block_extensions-method -->

    
      <div id="method-i-parse_block_html" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_block_html</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the HTML at the current position as block-level HTML.</p>
          
          

          
          <div class="method-source-code" id="parse_block_html-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/html.rb, line 69</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_block_html</span>
  <span class="ruby-identifier">line</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">HTML_COMMENT_RE</span>)
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:xml_comment</span>, <span class="ruby-identifier">result</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:category</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:block</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">line</span>)
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">TRAILING_WHITESPACE</span>)
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">HTML_INSTRUCTION_RE</span>)
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:xml_pi</span>, <span class="ruby-identifier">result</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:category</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:block</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">line</span>)
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">TRAILING_WHITESPACE</span>)
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-node">/^#{OPT_SPACE}#{HTML_TAG_RE}/</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-constant">HTML_SPAN_ELEMENTS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">downcase</span>)
      <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
      <span class="ruby-identifier">handle_html_start_tag</span>(<span class="ruby-identifier">line</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-value">:handle_kramdown_html_tag</span>))
      <span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Parser</span><span class="ruby-operator">::</span><span class="ruby-constant">Html</span><span class="ruby-operator">::</span><span class="ruby-constant">ElementConverter</span>.<span class="ruby-identifier">convert</span>(<span class="ruby-ivar">@root</span>, <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@options</span>[<span class="ruby-value">:html_to_native</span>]
      <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-node">/^#{OPT_SPACE}#{HTML_TAG_CLOSE_RE}/</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-constant">HTML_SPAN_ELEMENTS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">downcase</span>)
      <span class="ruby-identifier">name</span> = <span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">downcase</span>

      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:html_element</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">name</span>
        <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
        <span class="ruby-identifier">throw</span> <span class="ruby-value">:stop_block_parsing</span>, <span class="ruby-value">:found</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_block_html-source -->
          
        </div>

        

        
      </div><!-- parse_block_html-method -->

    
      <div id="method-i-parse_block_math" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_block_math</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the math block at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_block_math-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/math.rb, line 18</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_block_math</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">after_block_boundary?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>]
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/^#{OPT_SPACE}\/</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>[<span class="ruby-value">3</span>]
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">saved_pos</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">save_pos</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
  <span class="ruby-identifier">data</span> = <span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">strip</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">before_block_boundary?</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:math</span>, <span class="ruby-identifier">data</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:category</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:block</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">revert_pos</span>(<span class="ruby-identifier">saved_pos</span>)
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_block_math-source -->
          
        </div>

        

        
      </div><!-- parse_block_math-method -->

    
      <div id="method-i-parse_blockquote" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_blockquote</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the blockquote at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_blockquote-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/blockquote.rb, line 20</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_blockquote</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">PARAGRAPH_MATCH</span>)
  <span class="ruby-keyword">while</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">LAZY_END</span>)
    <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">PARAGRAPH_MATCH</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-constant">BLOCKQUOTE_START</span>, <span class="ruby-string">&#39;&#39;</span>)

  <span class="ruby-identifier">el</span> = <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:blockquote</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">el</span>
  <span class="ruby-identifier">parse_blocks</span>(<span class="ruby-identifier">el</span>, <span class="ruby-identifier">result</span>)
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_blockquote-source -->
          
        </div>

        

        
      </div><!-- parse_blockquote-method -->

    
      <div id="method-i-parse_codeblock" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_codeblock</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the indented codeblock at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_codeblock-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/codeblock.rb, line 22</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_codeblock</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-identifier">data</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">CODEBLOCK_MATCH</span>)
  <span class="ruby-identifier">data</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\n( {0,3}\S)/</span>, <span class="ruby-string">&#39; \1&#39;</span>)
  <span class="ruby-identifier">data</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-constant">INDENT</span>, <span class="ruby-string">&#39;&#39;</span>)
  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:codeblock</span>, <span class="ruby-identifier">data</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_codeblock-source -->
          
        </div>

        

        
      </div><!-- parse_codeblock-method -->

    
      <div id="method-i-parse_codeblock_fenced" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_codeblock_fenced</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the fenced codeblock at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_codeblock_fenced-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/codeblock.rb, line 37</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_codeblock_fenced</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">FENCED_CODEBLOCK_MATCH</span>)
    <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
    <span class="ruby-identifier">el</span> = <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:codeblock</span>, <span class="ruby-ivar">@src</span>[<span class="ruby-value">4</span>], <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
    <span class="ruby-identifier">lang</span> = <span class="ruby-ivar">@src</span>[<span class="ruby-value">3</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>
    <span class="ruby-identifier">el</span>.<span class="ruby-identifier">attr</span>[<span class="ruby-string">&#39;class&#39;</span>] = <span class="ruby-node">&quot;language-#{lang}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">lang</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">el</span>
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_codeblock_fenced-source -->
          
        </div>

        

        
      </div><!-- parse_codeblock_fenced-method -->

    
      <div id="method-i-parse_codespan" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_codespan</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the codespan at the current scanner location.</p>
          
          

          
          <div class="method-source-code" id="parse_codespan-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/codespan.rb, line 16</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_codespan</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">CODESPAN_DELIMITER</span>)
  <span class="ruby-identifier">simple</span> = (<span class="ruby-identifier">result</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>)
  <span class="ruby-identifier">saved_pos</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">save_pos</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">simple</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pre_match</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\s\Z/</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/\s/</span>)
    <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">result</span>)
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan_until</span>(<span class="ruby-node">/#{result}/</span>)
    <span class="ruby-identifier">text</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-node">/#{result}\Z/</span>, <span class="ruby-string">&#39;&#39;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">simple</span>
      <span class="ruby-identifier">text</span> = <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39; &#39;</span>
      <span class="ruby-identifier">text</span> = <span class="ruby-identifier">text</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">-1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39; &#39;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:codespan</span>, <span class="ruby-identifier">text</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">revert_pos</span>(<span class="ruby-identifier">saved_pos</span>)
    <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">result</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_codespan-source -->
          
        </div>

        

        
      </div><!-- parse_codespan-method -->

    
      <div id="method-i-parse_definition_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_definition_list</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the ordered or unordered list at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_definition_list-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/list.rb, line 151</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_definition_list</span>
  <span class="ruby-identifier">children</span> = <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">children</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:p</span> ) <span class="ruby-operator">||</span>
      (<span class="ruby-identifier">children</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">2</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">children</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:p</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">children</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:blank</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">children</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">value</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;\n&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">children</span>[<span class="ruby-value">-2</span>].<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:p</span>))
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">first_as_para</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">deflist</span> = <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:dl</span>)
  <span class="ruby-identifier">para</span> = <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">pop</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">para</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:blank</span>
    <span class="ruby-identifier">para</span> = <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">pop</span>
    <span class="ruby-identifier">first_as_para</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">deflist</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:location</span>] = <span class="ruby-identifier">para</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:location</span>] <span class="ruby-comment"># take location from preceding para which is the first definition term</span>
  <span class="ruby-identifier">para</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\n/</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">term</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">el</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:dt</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>)
    <span class="ruby-identifier">el</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:raw_text</span>, <span class="ruby-identifier">term</span>)
    <span class="ruby-identifier">deflist</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">el</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">deflist</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>] = <span class="ruby-identifier">para</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>]

  <span class="ruby-identifier">item</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">content_re</span>, <span class="ruby-identifier">lazy_re</span>, <span class="ruby-identifier">indent_re</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">def_start_re</span> = <span class="ruby-constant">DEFINITION_LIST_START</span>
  <span class="ruby-identifier">last_is_blank</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">while</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>.<span class="ruby-identifier">eos?</span>
    <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">def_start_re</span>)
      <span class="ruby-identifier">item</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:dd</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
      <span class="ruby-identifier">item</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:first_as_para</span>] = <span class="ruby-identifier">first_as_para</span>
      <span class="ruby-identifier">item</span>.<span class="ruby-identifier">value</span>, <span class="ruby-identifier">indentation</span>, <span class="ruby-identifier">content_re</span>, <span class="ruby-identifier">lazy_re</span>, <span class="ruby-identifier">indent_re</span> = <span class="ruby-identifier">parse_first_list_line</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">length</span>, <span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>])
      <span class="ruby-identifier">deflist</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">item</span>

      <span class="ruby-identifier">item</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">LIST_ITEM_IAL</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">parse_attribute_list</span>(<span class="ruby-node">$1</span>, <span class="ruby-identifier">item</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>] <span class="ruby-operator">||=</span> {})
        <span class="ruby-string">&#39;&#39;</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">def_start_re</span> = <span class="ruby-node">/^( {0,#{[3, indentation - 1].min}}:)([\t| ].*?\n)/</span>
      <span class="ruby-identifier">first_as_para</span> = <span class="ruby-keyword">false</span>
      <span class="ruby-identifier">last_is_blank</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-constant">EOB_MARKER</span>)
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">content_re</span>)) <span class="ruby-operator">||</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">last_is_blank</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">lazy_re</span>)))
      <span class="ruby-identifier">result</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/^(\t+)/</span>) { <span class="ruby-string">&quot; &quot;</span><span class="ruby-operator">*</span>(<span class="ruby-node">$1</span> <span class="ruby-operator">?</span> <span class="ruby-value">4</span><span class="ruby-operator">*</span><span class="ruby-node">$1</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>) }
      <span class="ruby-identifier">result</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-identifier">indent_re</span>, <span class="ruby-string">&#39;&#39;</span>)
      <span class="ruby-identifier">item</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">result</span>
      <span class="ruby-identifier">first_as_para</span> = <span class="ruby-keyword">false</span>
      <span class="ruby-identifier">last_is_blank</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">BLANK_LINE</span>)
      <span class="ruby-identifier">first_as_para</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">item</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">result</span>
      <span class="ruby-identifier">last_is_blank</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">last</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">deflist</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">it</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:dt</span>

    <span class="ruby-identifier">parse_blocks</span>(<span class="ruby-identifier">it</span>, <span class="ruby-identifier">it</span>.<span class="ruby-identifier">value</span>)
    <span class="ruby-identifier">it</span>.<span class="ruby-identifier">value</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:blank</span>
      <span class="ruby-identifier">last</span> = <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">pop</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">last</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:p</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">it</span>.<span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:first_as_para</span>)
      <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\n&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:transparent</span>] = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:dl</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">children</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">deflist</span>.<span class="ruby-identifier">children</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">2</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:blank</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>[<span class="ruby-value">-2</span>].<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:dl</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">pop</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">children</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">deflist</span>.<span class="ruby-identifier">children</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">deflist</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">last</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_definition_list-source -->
          
        </div>

        

        
      </div><!-- parse_definition_list-method -->

    
      <div id="method-i-parse_emphasis" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_emphasis</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the emphasis at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_emphasis-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/emphasis.rb, line 16</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_emphasis</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-identifier">saved_pos</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">save_pos</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">EMPHASIS_START</span>)
  <span class="ruby-identifier">element</span> = (<span class="ruby-identifier">result</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-operator">?</span> <span class="ruby-value">:strong</span> <span class="ruby-operator">:</span> <span class="ruby-value">:em</span>)
  <span class="ruby-identifier">type</span> = <span class="ruby-identifier">result</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">0</span>]

  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;_&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pre_match</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/[[:alnum:]]\z/</span>) <span class="ruby-operator">||</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\s/</span>) <span class="ruby-operator">||</span>
      <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">element</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@stack</span>.<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">el</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">element</span>}
    <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">result</span>)
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">sub_parse</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">delim</span>, <span class="ruby-identifier">elem</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">el</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">elem</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
    <span class="ruby-identifier">stop_re</span> = <span class="ruby-node">/#{Regexp.escape(delim)}/</span>
    <span class="ruby-identifier">found</span> = <span class="ruby-identifier">parse_spans</span>(<span class="ruby-identifier">el</span>, <span class="ruby-identifier">stop_re</span>) <span class="ruby-keyword">do</span>
      (<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pre_match</span>[<span class="ruby-value">-1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">!~</span> <span class="ruby-regexp">/\s/</span>) <span class="ruby-operator">&amp;&amp;</span>
        (<span class="ruby-identifier">elem</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:em</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-node">/#{Regexp.escape(delim*2)}(?!#{Regexp.escape(delim)})/</span>)) <span class="ruby-operator">&amp;&amp;</span>
        (<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;_&#39;</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-node">/#{Regexp.escape(delim)}[[:alnum:]]/</span>)) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-keyword">end</span>
    [<span class="ruby-identifier">found</span>, <span class="ruby-identifier">el</span>, <span class="ruby-identifier">stop_re</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">found</span>, <span class="ruby-identifier">el</span>, <span class="ruby-identifier">stop_re</span> = <span class="ruby-identifier">sub_parse</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">result</span>, <span class="ruby-identifier">element</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">found</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">element</span> <span class="ruby-operator">==</span> <span class="ruby-value">:strong</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:em</span>
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">revert_pos</span>(<span class="ruby-identifier">saved_pos</span>)
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">found</span>, <span class="ruby-identifier">el</span>, <span class="ruby-identifier">stop_re</span> = <span class="ruby-identifier">sub_parse</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">type</span>, <span class="ruby-value">:em</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">found</span>
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">stop_re</span>)
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">el</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">revert_pos</span>(<span class="ruby-identifier">saved_pos</span>)
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">length</span>
    <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">result</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_emphasis-source -->
          
        </div>

        

        
      </div><!-- parse_emphasis-method -->

    
      <div id="method-i-parse_eob_marker" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_eob_marker</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the EOB marker at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_eob_marker-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/eob.rb, line 16</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_eob_marker</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:eob</span>)
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_eob_marker-source -->
          
        </div>

        

        
      </div><!-- parse_eob_marker-method -->

    
      <div id="method-i-parse_escaped_chars" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_escaped_chars</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the backslash-escaped character at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_escaped_chars-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/escaped_chars.rb, line 16</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_escaped_chars</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
  <span class="ruby-identifier">add_text</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_escaped_chars-source -->
          
        </div>

        

        
      </div><!-- parse_escaped_chars-method -->

    
      <div id="method-i-parse_extension_start_tag" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_extension_start_tag</span><span
            class="method-args">(type)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the generic extension at the current point. The parameter
<code>type</code> can either be :block or :span depending whether we parse
a block or span extension tag.</p>
          
          

          
          <div class="method-source-code" id="parse_extension_start_tag-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/extensions.rb, line 55</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_extension_start_tag</span>(<span class="ruby-identifier">type</span>)
  <span class="ruby-identifier">saved_pos</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">save_pos</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>

  <span class="ruby-identifier">error_block</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">msg</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">warning</span>(<span class="ruby-identifier">msg</span>)
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">revert_pos</span>(<span class="ruby-identifier">saved_pos</span>)
    <span class="ruby-identifier">add_text</span>(<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">getch</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:span</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;{:/}&#39;</span>
    <span class="ruby-identifier">name</span> = (<span class="ruby-ivar">@src</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">?</span> <span class="ruby-node">&quot;for &#39;#{@src[4]}&#39; &quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">error_block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-node">&quot;Invalid extension stop tag #{name} found on line #{start_line_number} - ignoring it&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">ext</span> = <span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>]
  <span class="ruby-identifier">opts</span> = {}
  <span class="ruby-identifier">body</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">parse_attribute_list</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">opts</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>[<span class="ruby-value">3</span>]
    <span class="ruby-identifier">stop_re</span> = (<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block</span> <span class="ruby-operator">?</span> <span class="ruby-node">/#{EXT_BLOCK_STOP_STR % ext}/</span> <span class="ruby-operator">:</span> <span class="ruby-node">/#{EXT_STOP_STR % ext}/</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan_until</span>(<span class="ruby-identifier">stop_re</span>)
      <span class="ruby-identifier">body</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-identifier">stop_re</span>, <span class="ruby-string">&#39;&#39;</span>)
      <span class="ruby-identifier">body</span>.<span class="ruby-identifier">chomp!</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">error_block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-node">&quot;No stop tag for extension &#39;#{ext}&#39; found on line #{start_line_number} - ignoring it&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">handle_extension</span>(<span class="ruby-identifier">ext</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">start_line_number</span>)
    <span class="ruby-identifier">error_block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-node">&quot;Invalid extension with name &#39;#{ext}&#39; specified on line #{start_line_number} - ignoring it&quot;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_extension_start_tag-source -->
          
        </div>

        

        
      </div><!-- parse_extension_start_tag-method -->

    
      <div id="method-i-parse_first_list_line" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_first_list_line</span><span
            class="method-args">(indentation, content)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Used for parsing the first line of a list item or a definition, i.e. the
line with list item marker or the definition marker.</p>
          
          

          
          <div class="method-source-code" id="parse_first_list_line-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/list.rb, line 31</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_first_list_line</span>(<span class="ruby-identifier">indentation</span>, <span class="ruby-identifier">content</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">content</span> <span class="ruby-operator">=~</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">LIST_ITEM_IAL_CHECK</span>
    <span class="ruby-identifier">indentation</span> = <span class="ruby-value">4</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">while</span> <span class="ruby-identifier">content</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^ *\t/</span>
      <span class="ruby-identifier">temp</span> = <span class="ruby-identifier">content</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/^ */</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">indentation</span>
      <span class="ruby-identifier">content</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/^( *)(\t+)/</span>) {<span class="ruby-node">$1</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; &quot;</span><span class="ruby-operator">*</span>(<span class="ruby-value">4</span> <span class="ruby-operator">-</span> (<span class="ruby-identifier">temp</span> <span class="ruby-operator">%</span> <span class="ruby-value">4</span>) <span class="ruby-operator">+</span> (<span class="ruby-node">$2</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>)<span class="ruby-operator">*</span><span class="ruby-value">4</span>)}
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">indentation</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">content</span>[<span class="ruby-regexp">/^ */</span>].<span class="ruby-identifier">length</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">content</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/^\s*/</span>, <span class="ruby-string">&#39;&#39;</span>)

  [<span class="ruby-identifier">content</span>, <span class="ruby-identifier">indentation</span>, <span class="ruby-operator">*</span><span class="ruby-constant">PARSE_FIRST_LIST_LINE_REGEXP_CACHE</span>[<span class="ruby-identifier">indentation</span>]]
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_first_list_line-source -->
          
        </div>

        

        
      </div><!-- parse_first_list_line-method -->

    
      <div id="method-i-parse_footnote_definition" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_footnote_definition</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the foot note definition at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_footnote_definition-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/footnote.rb, line 20</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_footnote_definition</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>

  <span class="ruby-identifier">el</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:footnote_def</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
  <span class="ruby-identifier">parse_blocks</span>(<span class="ruby-identifier">el</span>, <span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">INDENT</span>, <span class="ruby-string">&#39;&#39;</span>))
  <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;Duplicate footnote name &#39;#{@src[1]}&#39; on line #{start_line_number} - overwriting&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@footnotes</span>[<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>]]
  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:eob</span>, <span class="ruby-value">:footnote_def</span>)
  (<span class="ruby-ivar">@footnotes</span>[<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>]] = {})[<span class="ruby-value">:content</span>] = <span class="ruby-identifier">el</span>
  <span class="ruby-ivar">@footnotes</span>[<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>]][<span class="ruby-value">:eob</span>] = <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_footnote_definition-source -->
          
        </div>

        

        
      </div><!-- parse_footnote_definition-method -->

    
      <div id="method-i-parse_footnote_marker" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_footnote_marker</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the footnote marker at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_footnote_marker-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/footnote.rb, line 38</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_footnote_marker</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
  <span class="ruby-identifier">fn_def</span> = <span class="ruby-ivar">@footnotes</span>[<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>]]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">fn_def</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">fn_def</span>[<span class="ruby-value">:eob</span>]
      <span class="ruby-identifier">update_attr_with_ial</span>(<span class="ruby-identifier">fn_def</span>[<span class="ruby-value">:eob</span>].<span class="ruby-identifier">attr</span>, <span class="ruby-identifier">fn_def</span>[<span class="ruby-value">:eob</span>].<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>] <span class="ruby-operator">||</span> {})
      <span class="ruby-identifier">fn_def</span>[<span class="ruby-value">:attr</span>] = <span class="ruby-identifier">fn_def</span>[<span class="ruby-value">:eob</span>].<span class="ruby-identifier">attr</span>
      <span class="ruby-identifier">fn_def</span>[<span class="ruby-value">:options</span>] = <span class="ruby-identifier">fn_def</span>[<span class="ruby-value">:eob</span>].<span class="ruby-identifier">options</span>
      <span class="ruby-identifier">fn_def</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:eob</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">fn_def</span>[<span class="ruby-value">:marker</span>] <span class="ruby-operator">||=</span> []
    <span class="ruby-identifier">fn_def</span>[<span class="ruby-value">:marker</span>].<span class="ruby-identifier">push</span>(<span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:footnote</span>, <span class="ruby-identifier">fn_def</span>[<span class="ruby-value">:content</span>], <span class="ruby-identifier">fn_def</span>[<span class="ruby-value">:attr</span>],
                                     <span class="ruby-identifier">fn_def</span>[<span class="ruby-value">:options</span>].<span class="ruby-identifier">merge</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>], <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)))
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">fn_def</span>[<span class="ruby-value">:marker</span>].<span class="ruby-identifier">last</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;Footnote definition for &#39;#{@src[1]}&#39; not found on line #{start_line_number}&quot;</span>)
    <span class="ruby-identifier">add_text</span>(<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_footnote_marker-source -->
          
        </div>

        

        
      </div><!-- parse_footnote_marker-method -->

    
      <div id="method-i-parse_horizontal_rule" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_horizontal_rule</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the horizontal rule at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_horizontal_rule-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/horizontal_rule.rb, line 16</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_horizontal_rule</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:hr</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_horizontal_rule-source -->
          
        </div>

        

        
      </div><!-- parse_horizontal_rule-method -->

    
      <div id="method-i-parse_html_entity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_html_entity</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the HTML entity at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_html_entity-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/html_entity.rb, line 16</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_html_entity</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:entity</span>, <span class="ruby-operator">::</span><span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">Entities</span>.<span class="ruby-identifier">entity</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">||</span> (<span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">to_i</span>) <span class="ruby-operator">||</span> <span class="ruby-ivar">@src</span>[<span class="ruby-value">3</span>].<span class="ruby-identifier">hex</span>),
                                  <span class="ruby-keyword">nil</span>, <span class="ruby-value">:original</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:entity</span>, <span class="ruby-operator">::</span><span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">Entities</span>.<span class="ruby-identifier">entity</span>(<span class="ruby-string">&#39;amp&#39;</span>),
                                  <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
    <span class="ruby-identifier">add_text</span>(<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>])
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_html_entity-source -->
          
        </div>

        

        
      </div><!-- parse_html_entity-method -->

    
      <div id="method-i-parse_inline_math" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_inline_math</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the inline math at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_inline_math-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/math.rb, line 44</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_inline_math</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:math</span>, <span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">strip</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:category</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:span</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_inline_math-source -->
          
        </div>

        

        
      </div><!-- parse_inline_math-method -->

    
      <div id="method-i-parse_line_break" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_line_break</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the line break at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_line_break-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/line_break.rb, line 16</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_line_break</span>
  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:br</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>)
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_line_break-source -->
          
        </div>

        

        
      </div><!-- parse_line_break-method -->

    
      <div id="method-i-parse_link" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_link</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the link at the current scanner position. This method is used to
parse normal links as well as image links.</p>
          
          

          
          <div class="method-source-code" id="parse_link-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/link.rb, line 58</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_link</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">LINK_START</span>)
  <span class="ruby-identifier">cur_pos</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span>
  <span class="ruby-identifier">saved_pos</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">save_pos</span>

  <span class="ruby-identifier">link_type</span> = (<span class="ruby-identifier">result</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^!/</span> <span class="ruby-operator">?</span> <span class="ruby-value">:img</span> <span class="ruby-operator">:</span> <span class="ruby-value">:a</span>)

  <span class="ruby-comment"># no nested links allowed</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">link_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:a</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:img</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:a</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@stack</span>.<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span>,<span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">t</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:img</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:a</span>)})
    <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">result</span>)
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">el</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">link_type</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)

  <span class="ruby-identifier">count</span> = <span class="ruby-value">1</span>
  <span class="ruby-identifier">found</span> = <span class="ruby-identifier">parse_spans</span>(<span class="ruby-identifier">el</span>, <span class="ruby-constant">LINK_BRACKET_STOP_RE</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">count</span> = <span class="ruby-identifier">count</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">-1</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
    <span class="ruby-identifier">count</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:img</span>}.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">found</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">link_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:a</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">empty?</span>)
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">revert_pos</span>(<span class="ruby-identifier">saved_pos</span>)
    <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">result</span>)
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">alt_text</span> = <span class="ruby-identifier">extract_string</span>(<span class="ruby-identifier">cur_pos</span><span class="ruby-operator">...</span><span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span>, <span class="ruby-ivar">@src</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">ESCAPED_CHARS</span>, <span class="ruby-string">&#39;\1&#39;</span>)
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">LINK_BRACKET_STOP_RE</span>)

  <span class="ruby-comment"># reference style link or no link url</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">LINK_INLINE_ID_RE</span>) <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\(/</span>)
    <span class="ruby-identifier">link_id</span> = <span class="ruby-identifier">normalize_link_id</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">alt_text</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@link_defs</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">link_id</span>)
      <span class="ruby-identifier">add_link</span>(<span class="ruby-identifier">el</span>, <span class="ruby-ivar">@link_defs</span>[<span class="ruby-identifier">link_id</span>][<span class="ruby-value">0</span>], <span class="ruby-ivar">@link_defs</span>[<span class="ruby-identifier">link_id</span>][<span class="ruby-value">1</span>], <span class="ruby-identifier">alt_text</span>,
               <span class="ruby-ivar">@link_defs</span>[<span class="ruby-identifier">link_id</span>][<span class="ruby-value">2</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@link_defs</span>[<span class="ruby-identifier">link_id</span>][<span class="ruby-value">2</span>].<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>])
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;No link definition for link ID &#39;#{link_id}&#39; found on line #{start_line_number}&quot;</span>)
      <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">revert_pos</span>(<span class="ruby-identifier">saved_pos</span>)
      <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">result</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># link url in parentheses</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\(&lt;(.*?)&gt;/</span>)
    <span class="ruby-identifier">link_url</span> = <span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\)/</span>)
      <span class="ruby-identifier">add_link</span>(<span class="ruby-identifier">el</span>, <span class="ruby-identifier">link_url</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">alt_text</span>)
      <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">link_url</span> = <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-identifier">nr_of_brackets</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">while</span> <span class="ruby-identifier">temp</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan_until</span>(<span class="ruby-constant">LINK_PAREN_STOP_RE</span>)
      <span class="ruby-identifier">link_url</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">temp</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>]
        <span class="ruby-identifier">nr_of_brackets</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">nr_of_brackets</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>]
        <span class="ruby-identifier">nr_of_brackets</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">break</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">link_url</span> = <span class="ruby-identifier">link_url</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>]
    <span class="ruby-identifier">link_url</span>.<span class="ruby-identifier">strip!</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">nr_of_brackets</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-identifier">add_link</span>(<span class="ruby-identifier">el</span>, <span class="ruby-identifier">link_url</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">alt_text</span>)
      <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">LINK_INLINE_TITLE_RE</span>)
    <span class="ruby-identifier">add_link</span>(<span class="ruby-identifier">el</span>, <span class="ruby-identifier">link_url</span>, <span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>], <span class="ruby-identifier">alt_text</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">revert_pos</span>(<span class="ruby-identifier">saved_pos</span>)
    <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">result</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_link-source -->
          
        </div>

        

        
      </div><!-- parse_link-method -->

    
      <div id="method-i-parse_link_definition" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_link_definition</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the link definition at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_link_definition-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/link.rb, line 23</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_link_definition</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
  <span class="ruby-identifier">link_id</span>, <span class="ruby-identifier">link_url</span>, <span class="ruby-identifier">link_title</span> = <span class="ruby-identifier">normalize_link_id</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>]), <span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@src</span>[<span class="ruby-value">3</span>], <span class="ruby-ivar">@src</span>[<span class="ruby-value">5</span>]
  <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;Duplicate link ID &#39;#{link_id}&#39; on line #{@src.current_line_number} - overwriting&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@link_defs</span>[<span class="ruby-identifier">link_id</span>]
  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:eob</span>, <span class="ruby-value">:link_def</span>)
  <span class="ruby-ivar">@link_defs</span>[<span class="ruby-identifier">link_id</span>] = [<span class="ruby-identifier">link_url</span>, <span class="ruby-identifier">link_title</span>, <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>]
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_link_definition-source -->
          
        </div>

        

        
      </div><!-- parse_link_definition-method -->

    
      <div id="method-i-parse_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_list</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the ordered or unordered list at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_list-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/list.rb, line 52</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_list</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-identifier">type</span>, <span class="ruby-identifier">list_start_re</span> = (<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-constant">LIST_START_UL</span>) <span class="ruby-operator">?</span> [<span class="ruby-value">:ul</span>, <span class="ruby-constant">LIST_START_UL</span>] <span class="ruby-operator">:</span> [<span class="ruby-value">:ol</span>, <span class="ruby-constant">LIST_START_OL</span>])
  <span class="ruby-identifier">list</span> = <span class="ruby-identifier">new_block_el</span>(<span class="ruby-identifier">type</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)

  <span class="ruby-identifier">item</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">content_re</span>, <span class="ruby-identifier">lazy_re</span>, <span class="ruby-identifier">indent_re</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">eob_found</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">nested_list_found</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">last_is_blank</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">while</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>.<span class="ruby-identifier">eos?</span>
    <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">last_is_blank</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-constant">HR_START</span>)
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">EOB_MARKER</span>)
      <span class="ruby-identifier">eob_found</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">list_start_re</span>)
      <span class="ruby-identifier">item</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:li</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
      <span class="ruby-identifier">item</span>.<span class="ruby-identifier">value</span>, <span class="ruby-identifier">indentation</span>, <span class="ruby-identifier">content_re</span>, <span class="ruby-identifier">lazy_re</span>, <span class="ruby-identifier">indent_re</span> = <span class="ruby-identifier">parse_first_list_line</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">length</span>, <span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>])
      <span class="ruby-identifier">list</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">item</span>

      <span class="ruby-identifier">item</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">LIST_ITEM_IAL</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">parse_attribute_list</span>(<span class="ruby-node">$1</span>, <span class="ruby-identifier">item</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>] <span class="ruby-operator">||=</span> {})
        <span class="ruby-string">&#39;&#39;</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">list_start_re</span> = (<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:ul</span> <span class="ruby-operator">?</span> <span class="ruby-node">/^( {0,#{[3, indentation - 1].min}}[+*-])([\t| ].*?\n)/</span> <span class="ruby-operator">:</span>
                       <span class="ruby-node">/^( {0,#{[3, indentation - 1].min}}\d+\.)([\t| ].*?\n)/</span>)
      <span class="ruby-identifier">nested_list_found</span> = (<span class="ruby-identifier">item</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">LIST_START</span>)
      <span class="ruby-identifier">last_is_blank</span> = <span class="ruby-keyword">false</span>
      <span class="ruby-identifier">item</span>.<span class="ruby-identifier">value</span> = [<span class="ruby-identifier">item</span>.<span class="ruby-identifier">value</span>]
    <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">content_re</span>)) <span class="ruby-operator">||</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">last_is_blank</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">lazy_re</span>)))
      <span class="ruby-identifier">result</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/^(\t+)/</span>) { <span class="ruby-string">&quot; &quot;</span> <span class="ruby-operator">*</span> <span class="ruby-value">4</span> <span class="ruby-operator">*</span> <span class="ruby-node">$1</span>.<span class="ruby-identifier">length</span> }
      <span class="ruby-identifier">result</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-identifier">indent_re</span>, <span class="ruby-string">&#39;&#39;</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">nested_list_found</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">result</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">LIST_START</span>
        <span class="ruby-identifier">item</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;&#39;</span>
        <span class="ruby-identifier">nested_list_found</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">item</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">result</span>
      <span class="ruby-identifier">last_is_blank</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">BLANK_LINE</span>)
      <span class="ruby-identifier">nested_list_found</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">last_is_blank</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">item</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">result</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">list</span>

  <span class="ruby-identifier">last</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">list</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">it</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">temp</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:temp</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:location</span>])

    <span class="ruby-identifier">env</span> = <span class="ruby-identifier">save_env</span>
    <span class="ruby-identifier">location</span> = <span class="ruby-identifier">it</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:location</span>]
    <span class="ruby-identifier">it</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@src</span> = <span class="ruby-operator">::</span><span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">StringScanner</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">val</span>, <span class="ruby-identifier">location</span>)
      <span class="ruby-identifier">parse_blocks</span>(<span class="ruby-identifier">temp</span>)
      <span class="ruby-identifier">location</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">restore_env</span>(<span class="ruby-identifier">env</span>)

    <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span> = <span class="ruby-identifier">temp</span>.<span class="ruby-identifier">children</span>
    <span class="ruby-identifier">it</span>.<span class="ruby-identifier">value</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>

    <span class="ruby-comment"># Handle the case where an EOB marker is inserted by a block IAL for the first paragraph</span>
    <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:p</span> <span class="ruby-operator">&amp;&amp;</span>
      <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">2</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:eob</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>]

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:p</span> <span class="ruby-operator">&amp;&amp;</span>
        (<span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">2</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:blank</span> <span class="ruby-operator">||</span>
         (<span class="ruby-identifier">it</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">eob_found</span>)) <span class="ruby-operator">&amp;&amp;</span>
        (<span class="ruby-identifier">list</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">it</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">||</span>
         <span class="ruby-identifier">list</span>.<span class="ruby-identifier">children</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>].<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">cit</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cit</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">cit</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:p</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">cit</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:transparent</span>]})
      <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\n&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:blank</span>
      <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:transparent</span>] = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:blank</span>
      <span class="ruby-identifier">last</span> = <span class="ruby-identifier">it</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">pop</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">last</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">last</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">eob_found</span>

  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_list-source -->
          
        </div>

        

        
      </div><!-- parse_list-method -->

    
      <div id="method-i-parse_paragraph" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_paragraph</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the paragraph at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_paragraph-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/paragraph.rb, line 30</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_paragraph</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">PARAGRAPH_MATCH</span>)
  <span class="ruby-keyword">while</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">PARAGRAPH_END</span>)
    <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">PARAGRAPH_MATCH</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">rstrip!</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:p</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">result</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:p</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">lstrip!</span>
    <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">result</span>, <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_paragraph-source -->
          
        </div>

        

        
      </div><!-- parse_paragraph-method -->

    
      <div id="method-i-parse_setext_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_setext_header</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the Setext header at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_setext_header-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/header.rb, line 19</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_setext_header</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">after_block_boundary?</span>

  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
  <span class="ruby-identifier">text</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">level</span> = <span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>], <span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>], <span class="ruby-ivar">@src</span>[<span class="ruby-value">3</span>]
  <span class="ruby-identifier">text</span>.<span class="ruby-identifier">strip!</span>
  <span class="ruby-identifier">el</span> = <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:header</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:level</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">level</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;-&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>), <span class="ruby-value">:raw_text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">text</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
  <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">el</span>)
  <span class="ruby-identifier">el</span>.<span class="ruby-identifier">attr</span>[<span class="ruby-string">&#39;id&#39;</span>] = <span class="ruby-identifier">id</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">id</span>
  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">el</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_setext_header-source -->
          
        </div>

        

        
      </div><!-- parse_setext_header-method -->

    
      <div id="method-i-parse_smart_quotes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_smart_quotes</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the smart quotes at current location.</p>
          
          

          
          <div class="method-source-code" id="parse_smart_quotes-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/smart_quotes.rb, line 157</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_smart_quotes</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-identifier">substs</span> = <span class="ruby-constant">SQ_RULES</span>.<span class="ruby-identifier">find</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">reg</span>, <span class="ruby-identifier">subst</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">reg</span>)}[<span class="ruby-value">1</span>]
  <span class="ruby-identifier">substs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">subst</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">subst</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Integer</span>)
      <span class="ruby-identifier">add_text</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-identifier">subst</span>])
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">val</span> = <span class="ruby-constant">SQ_SUBSTS</span>[[<span class="ruby-identifier">subst</span>, <span class="ruby-ivar">@src</span>[<span class="ruby-identifier">subst</span>.<span class="ruby-identifier">to_s</span>[<span class="ruby-value">-1</span>,<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>]]] <span class="ruby-operator">||</span> <span class="ruby-identifier">subst</span>
      <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:smart_quote</span>, <span class="ruby-identifier">val</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_smart_quotes-source -->
          
        </div>

        

        
      </div><!-- parse_smart_quotes-method -->

    
      <div id="method-i-parse_span_extensions" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_span_extensions</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the extension span at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_span_extensions-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/extensions.rb, line 179</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_span_extensions</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-constant">EXT_SPAN_START</span>)
    <span class="ruby-identifier">parse_extension_start_tag</span>(<span class="ruby-value">:span</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-constant">IAL_SPAN_START</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:text</span>
      <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
      <span class="ruby-identifier">attr</span> = <span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderedHash</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-identifier">parse_attribute_list</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">attr</span>)
      <span class="ruby-identifier">update_ial_with_ial</span>(<span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderedHash</span>.<span class="ruby-identifier">new</span>, <span class="ruby-identifier">attr</span>)
      <span class="ruby-identifier">update_attr_with_ial</span>(<span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">attr</span>, <span class="ruby-identifier">attr</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">warning</span>(<span class="ruby-string">&quot;Found span IAL after text - ignoring it&quot;</span>)
      <span class="ruby-identifier">add_text</span>(<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">getch</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">add_text</span>(<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">getch</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_span_extensions-source -->
          
        </div>

        

        
      </div><!-- parse_span_extensions-method -->

    
      <div id="method-i-parse_span_html" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_span_html</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the HTML at the current position as span-level HTML.</p>
          
          

          
          <div class="method-source-code" id="parse_span_html-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/html.rb, line 105</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_span_html</span>
  <span class="ruby-identifier">line</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">HTML_COMMENT_RE</span>)
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:xml_comment</span>, <span class="ruby-identifier">result</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:category</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:span</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">line</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">HTML_INSTRUCTION_RE</span>)
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:xml_pi</span>, <span class="ruby-identifier">result</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:category</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:span</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">line</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">HTML_TAG_CLOSE_RE</span>)
    <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;Found invalidly used HTML closing tag for &#39;#{@src[1]}&#39; on line #{line}&quot;</span>)
    <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">result</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">HTML_TAG_RE</span>)
    <span class="ruby-identifier">tag_name</span> = <span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">downcase</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">HTML_BLOCK_ELEMENTS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">tag_name</span>)
      <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;Found block HTML tag &#39;#{tag_name}&#39; in span-level text on line #{line}&quot;</span>)
      <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">result</span>)
      <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">attrs</span> = <span class="ruby-identifier">parse_html_attributes</span>(<span class="ruby-ivar">@src</span>[<span class="ruby-value">2</span>], <span class="ruby-identifier">line</span>)
    <span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\n+/</span>, <span class="ruby-string">&#39; &#39;</span>)}

    <span class="ruby-identifier">do_parsing</span> = (<span class="ruby-constant">HTML_CONTENT_MODEL</span>[<span class="ruby-identifier">tag_name</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:raw</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:content_model</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:raw</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@options</span>[<span class="ruby-value">:parse_span_html</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> = <span class="ruby-constant">HTML_MARKDOWN_ATTR_MAP</span>[<span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;markdown&#39;</span>)]
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block</span>
        <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;Cannot use block-level parsing in span-level HTML tag (line #{line}) - using default mode&quot;</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">==</span> <span class="ruby-value">:span</span>
        <span class="ruby-identifier">do_parsing</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">==</span> <span class="ruby-value">:default</span>
        <span class="ruby-identifier">do_parsing</span> = <span class="ruby-constant">HTML_CONTENT_MODEL</span>[<span class="ruby-identifier">tag_name</span>] <span class="ruby-operator">!=</span> <span class="ruby-value">:raw</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">==</span> <span class="ruby-value">:raw</span>
        <span class="ruby-identifier">do_parsing</span> = <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">el</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:html_element</span>, <span class="ruby-identifier">tag_name</span>, <span class="ruby-identifier">attrs</span>, <span class="ruby-value">:category</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:span</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">line</span>,
                     <span class="ruby-value">:content_model</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">do_parsing</span> <span class="ruby-operator">?</span> <span class="ruby-value">:span</span> <span class="ruby-operator">:</span> <span class="ruby-value">:raw</span>), <span class="ruby-value">:is_closed</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>[<span class="ruby-value">4</span>])
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">el</span>
    <span class="ruby-identifier">stop_re</span> = <span class="ruby-node">/&lt;\/#{Regexp.escape(tag_name)}\s*&gt;/</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">HTML_ELEMENTS_WITHOUT_BODY</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">el</span>.<span class="ruby-identifier">value</span>)
      <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;The HTML tag &#39;#{el.value}&#39; on line #{line} cannot have any content - auto-closing it&quot;</span>)
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>[<span class="ruby-value">4</span>]
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">parse_spans</span>(<span class="ruby-identifier">el</span>, <span class="ruby-identifier">stop_re</span>, (<span class="ruby-identifier">do_parsing</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> [<span class="ruby-value">:span_html</span>]))
        <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">stop_re</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;Found no end tag for &#39;#{el.value}&#39; (line #{line}) - auto-closing it&quot;</span>)
        <span class="ruby-identifier">add_text</span>(<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">rest</span>, <span class="ruby-identifier">el</span>)
        <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">terminate</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Parser</span><span class="ruby-operator">::</span><span class="ruby-constant">Html</span><span class="ruby-operator">::</span><span class="ruby-constant">ElementConverter</span>.<span class="ruby-identifier">convert</span>(<span class="ruby-ivar">@root</span>, <span class="ruby-identifier">el</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@options</span>[<span class="ruby-value">:html_to_native</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">add_text</span>(<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">getch</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_span_html-source -->
          
        </div>

        

        
      </div><!-- parse_span_html-method -->

    
      <div id="method-i-parse_table" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_table</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the table at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_table-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/table.rb, line 24</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_table</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">after_block_boundary?</span>

  <span class="ruby-identifier">saved_pos</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">save_pos</span>
  <span class="ruby-identifier">orig_pos</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span>
  <span class="ruby-identifier">table</span> = <span class="ruby-identifier">new_block_el</span>(<span class="ruby-value">:table</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:alignment</span> =<span class="ruby-operator">&gt;</span> [], <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>)
  <span class="ruby-identifier">leading_pipe</span> = (<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-constant">TABLE_LINE</span>) <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^\s*\|/</span>)
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">TABLE_SEP_LINE</span>)

  <span class="ruby-identifier">rows</span> = []
  <span class="ruby-identifier">has_footer</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">columns</span> = <span class="ruby-value">0</span>

  <span class="ruby-identifier">add_container</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span>, <span class="ruby-identifier">force</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">has_footer</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:tbody</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">force</span>
      <span class="ruby-identifier">cont</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">type</span>)
      <span class="ruby-identifier">cont</span>.<span class="ruby-identifier">children</span>, <span class="ruby-identifier">rows</span> = <span class="ruby-identifier">rows</span>, []
      <span class="ruby-identifier">table</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cont</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">while</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>.<span class="ruby-identifier">eos?</span>
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-constant">TABLE_LINE</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">TABLE_SEP_LINE</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">rows</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">table</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:alignment</span>].<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">has_footer</span>
        <span class="ruby-identifier">add_container</span>.<span class="ruby-identifier">call</span>(<span class="ruby-value">:thead</span>, <span class="ruby-keyword">false</span>)
        <span class="ruby-identifier">table</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:alignment</span>] = <span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">scan</span>(<span class="ruby-constant">TABLE_HSEP_ALIGN</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">left</span>, <span class="ruby-identifier">right</span><span class="ruby-operator">|</span>
          (<span class="ruby-identifier">left</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">right</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value">:default</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">right</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value">:left</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">left</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value">:right</span>) <span class="ruby-operator">||</span> <span class="ruby-value">:center</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span> <span class="ruby-comment"># treat as normal separator line</span>
        <span class="ruby-identifier">add_container</span>.<span class="ruby-identifier">call</span>(<span class="ruby-value">:tbody</span>, <span class="ruby-keyword">false</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">TABLE_FSEP_LINE</span>)
      <span class="ruby-identifier">add_container</span>.<span class="ruby-identifier">call</span>(<span class="ruby-value">:tbody</span>, <span class="ruby-keyword">true</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">rows</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">has_footer</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">TABLE_ROW_LINE</span>)
      <span class="ruby-identifier">trow</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:tr</span>)

      <span class="ruby-comment"># parse possible code spans on the line and correctly split the line into cells</span>
      <span class="ruby-identifier">env</span> = <span class="ruby-identifier">save_env</span>
      <span class="ruby-identifier">cells</span> = []
      <span class="ruby-ivar">@src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/(&lt;code.*?&gt;.*?&lt;\/code&gt;)/</span>).<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">str</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">%</span> <span class="ruby-value">2</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
          (<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">cells</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">last</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">str</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">reset_env</span>(<span class="ruby-value">:src</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">StringScanner</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">str</span>, <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>))
          <span class="ruby-identifier">root</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:root</span>)
          <span class="ruby-identifier">parse_spans</span>(<span class="ruby-identifier">root</span>, <span class="ruby-keyword">nil</span>, [<span class="ruby-value">:codespan</span>])

          <span class="ruby-identifier">root</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:raw_text</span>
              <span class="ruby-comment"># Only on Ruby 1.9: f, *l = c.value.split(/(?&lt;!\\)\|/).map {|t| t.gsub(/\\\|/, &#39;|&#39;)}</span>
              <span class="ruby-identifier">f</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">l</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\\|/</span>, <span class="ruby-value">-1</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\|/</span>, <span class="ruby-value">-1</span>)}.<span class="ruby-identifier">inject</span>([]) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">memo</span>, <span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">memo</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;|#{t.shift}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">memo</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                <span class="ruby-identifier">memo</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">t</span>)
              <span class="ruby-keyword">end</span>
              (<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">cells</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">last</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">f</span>
              <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">l</span>)
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">delim</span> = (<span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/`+/</span>).<span class="ruby-identifier">max</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&#39;`&#39;</span>
              <span class="ruby-identifier">tmp</span> = <span class="ruby-node">&quot;#{delim}#{&#39; &#39; if delim.size &gt; 1}#{c.value}#{&#39; &#39; if delim.size &gt; 1}#{delim}&quot;</span>
              (<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">cells</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">last</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tmp</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">restore_env</span>(<span class="ruby-identifier">env</span>)

      <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">shift</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">leading_pipe</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">pop</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell_text</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">tcell</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:td</span>)
        <span class="ruby-identifier">tcell</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:raw_text</span>, <span class="ruby-identifier">cell_text</span>.<span class="ruby-identifier">strip</span>)
        <span class="ruby-identifier">trow</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tcell</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">columns</span> = [<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">length</span>].<span class="ruby-identifier">max</span>
      <span class="ruby-identifier">rows</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">trow</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">before_block_boundary?</span>
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">revert_pos</span>(<span class="ruby-identifier">saved_pos</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Parse all lines of the table with the code span parser</span>
  <span class="ruby-identifier">env</span> = <span class="ruby-identifier">save_env</span>
  <span class="ruby-identifier">l_src</span> = <span class="ruby-operator">::</span><span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">StringScanner</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">extract_string</span>(<span class="ruby-identifier">orig_pos</span><span class="ruby-operator">...</span>(<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>), <span class="ruby-ivar">@src</span>),
                                               <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>)
  <span class="ruby-identifier">reset_env</span>(<span class="ruby-value">:src</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">l_src</span>)
  <span class="ruby-identifier">root</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:root</span>)
  <span class="ruby-identifier">parse_spans</span>(<span class="ruby-identifier">root</span>, <span class="ruby-keyword">nil</span>, [<span class="ruby-value">:codespan</span>, <span class="ruby-value">:span_html</span>])
  <span class="ruby-identifier">restore_env</span>(<span class="ruby-identifier">env</span>)

  <span class="ruby-comment"># Check if each line has at least one unescaped pipe that is not inside a code span/code</span>
  <span class="ruby-comment"># HTML element</span>
  <span class="ruby-comment"># Note: It doesn&#39;t matter that we parse *all* span HTML elements because the row splitting</span>
  <span class="ruby-comment"># algorithm above only takes &lt;code&gt; elements into account!</span>
  <span class="ruby-identifier">pipe_on_line</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">while</span> (<span class="ruby-identifier">c</span> = <span class="ruby-identifier">root</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">shift</span>)
    <span class="ruby-identifier">lines</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\n/</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:codespan</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">lines</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pipe_on_line</span>)
        <span class="ruby-keyword">break</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">pipe_on_line</span>
        <span class="ruby-identifier">pipe_on_line</span> = <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pipe_on_line</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">!~</span> <span class="ruby-node">/^#{TABLE_PIPE_CHECK}/</span>
      <span class="ruby-identifier">pipe_on_line</span> = (<span class="ruby-identifier">lines</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">pipe_on_line</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">lines</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/^#{TABLE_PIPE_CHECK}/</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">revert_pos</span>(<span class="ruby-identifier">saved_pos</span>) <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pipe_on_line</span>

  <span class="ruby-identifier">add_container</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">has_footer</span> <span class="ruby-operator">?</span> <span class="ruby-value">:tfoot</span> <span class="ruby-operator">:</span> <span class="ruby-value">:tbody</span>, <span class="ruby-keyword">false</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">rows</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">table</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:tbody</span>}
    <span class="ruby-identifier">warning</span>(<span class="ruby-node">&quot;Found table without body on line #{table.options[:location]} - ignoring it&quot;</span>)
    <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">revert_pos</span>(<span class="ruby-identifier">saved_pos</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># adjust all table rows to have equal number of columns, same for alignment defs</span>
  <span class="ruby-identifier">table</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">kind</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">kind</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
      (<span class="ruby-identifier">columns</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">length</span>).<span class="ruby-identifier">times</span> <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">row</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:td</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">table</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:alignment</span>].<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">columns</span>
    <span class="ruby-identifier">table</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:alignment</span>] = <span class="ruby-identifier">table</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:alignment</span>][<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">columns</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">table</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:alignment</span>] <span class="ruby-operator">+=</span> [<span class="ruby-value">:default</span>] <span class="ruby-operator">*</span> (<span class="ruby-identifier">columns</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">table</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:alignment</span>].<span class="ruby-identifier">length</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">table</span>

  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_table-source -->
          
        </div>

        

        
      </div><!-- parse_table-method -->

    
      <div id="method-i-parse_typographic_syms" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_typographic_syms</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the typographic symbols at the current location.</p>
          
          

          
          <div class="method-source-code" id="parse_typographic_syms-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/typographic_symbol.rb, line 21</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_typographic_syms</span>
  <span class="ruby-identifier">start_line_number</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">current_line_number</span>
  <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched_size</span>
  <span class="ruby-identifier">val</span> = <span class="ruby-constant">TYPOGRAPHIC_SYMS_SUBST</span>[<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Symbol</span>)
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:typographic_sym</span>, <span class="ruby-identifier">val</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">matched</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;\&lt;&lt;&#39;</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:entity</span>, <span class="ruby-operator">::</span><span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">Entities</span>.<span class="ruby-identifier">entity</span>(<span class="ruby-string">&#39;lt&#39;</span>),
                                  <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:entity</span>, <span class="ruby-operator">::</span><span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">Entities</span>.<span class="ruby-identifier">entity</span>(<span class="ruby-string">&#39;lt&#39;</span>),
                                  <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:entity</span>, <span class="ruby-operator">::</span><span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">Entities</span>.<span class="ruby-identifier">entity</span>(<span class="ruby-string">&#39;gt&#39;</span>),
                                  <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
    <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:entity</span>, <span class="ruby-operator">::</span><span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">Entities</span>.<span class="ruby-identifier">entity</span>(<span class="ruby-string">&#39;gt&#39;</span>),
                                  <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_line_number</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_typographic_syms-source -->
          
        </div>

        

        
      </div><!-- parse_typographic_syms-method -->

    
      <div id="method-i-replace_abbreviations" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">replace_abbreviations</span><span
            class="method-args">(el, regexps = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Replace the abbreviation text with elements.</p>
          
          

          
          <div class="method-source-code" id="replace_abbreviations-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/abbreviation.rb, line 37</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">replace_abbreviations</span>(<span class="ruby-identifier">el</span>, <span class="ruby-identifier">regexps</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@root</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:abbrev_defs</span>].<span class="ruby-identifier">empty?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">regexps</span>
    <span class="ruby-identifier">sorted_abbrevs</span> = <span class="ruby-ivar">@root</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:abbrev_defs</span>].<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">length</span>}
    <span class="ruby-identifier">regexps</span> = [<span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">union</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">sorted_abbrevs</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-node">/#{Regexp.escape(k)}/</span>})]
    <span class="ruby-identifier">regexps</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">/(?=(?:\W|^)#{regexps.first}(?!\w))/</span> <span class="ruby-comment"># regexp should only match on word boundaries</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">el</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:text</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">regexps</span>.<span class="ruby-identifier">first</span>
        <span class="ruby-identifier">result</span> = []
        <span class="ruby-identifier">strscan</span> = <span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">StringScanner</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">child</span>.<span class="ruby-identifier">value</span>, <span class="ruby-identifier">child</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:location</span>])
        <span class="ruby-identifier">text_lineno</span> = <span class="ruby-identifier">strscan</span>.<span class="ruby-identifier">current_line_number</span>
        <span class="ruby-keyword">while</span> <span class="ruby-identifier">temp</span> = <span class="ruby-identifier">strscan</span>.<span class="ruby-identifier">scan_until</span>(<span class="ruby-identifier">regexps</span>.<span class="ruby-identifier">last</span>)
          <span class="ruby-identifier">abbr_lineno</span> = <span class="ruby-identifier">strscan</span>.<span class="ruby-identifier">current_line_number</span>
          <span class="ruby-identifier">abbr</span> = <span class="ruby-identifier">strscan</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">regexps</span>.<span class="ruby-identifier">first</span>) <span class="ruby-comment"># begin of line case of abbr with \W char as first one</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">abbr</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">temp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">strscan</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\W|^/</span>)
            <span class="ruby-identifier">abbr</span> = <span class="ruby-identifier">strscan</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">regexps</span>.<span class="ruby-identifier">first</span>)
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:text</span>, <span class="ruby-identifier">temp</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">text_lineno</span>)
          <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:abbreviation</span>, <span class="ruby-identifier">abbr</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">abbr_lineno</span>)
          <span class="ruby-identifier">text_lineno</span> = <span class="ruby-identifier">strscan</span>.<span class="ruby-identifier">current_line_number</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:text</span>, <span class="ruby-identifier">strscan</span>.<span class="ruby-identifier">rest</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">text_lineno</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">child</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">replace_abbreviations</span>(<span class="ruby-identifier">child</span>, <span class="ruby-identifier">regexps</span>)
      <span class="ruby-identifier">child</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">flatten!</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- replace_abbreviations-source -->
          
        </div>

        

        
      </div><!-- replace_abbreviations-method -->

    
      <div id="method-i-update_ial_with_ial" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_ial_with_ial</span><span
            class="method-args">(ial, opts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Update the <code>ial</code> with the information from the inline attribute
list <code>opts</code>.</p>
          
          

          
          <div class="method-source-code" id="update_ial_with_ial-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown/extensions.rb, line 41</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_ial_with_ial</span>(<span class="ruby-identifier">ial</span>, <span class="ruby-identifier">opts</span>)
  (<span class="ruby-identifier">ial</span>[<span class="ruby-value">:refs</span>] <span class="ruby-operator">||=</span> []) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:refs</span>]
  <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-constant">IAL_CLASS_ATTR</span>
      <span class="ruby-identifier">ial</span>[<span class="ruby-identifier">k</span>] = (<span class="ruby-identifier">ial</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; #{v}&quot;</span>
      <span class="ruby-identifier">ial</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">lstrip!</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">String</span>)
      <span class="ruby-identifier">ial</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_ial_with_ial-source -->
          
        </div>

        

        
      </div><!-- update_ial_with_ial-method -->

    
    </section><!-- public-instance-method-details -->
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Protected Instance Methods</h3>

    
      <div id="method-i-configure_parser" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">configure_parser</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adapt the object to allow parsing like specified in the options.</p>
          
          

          
          <div class="method-source-code" id="configure_parser-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 111</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">configure_parser</span>
  <span class="ruby-ivar">@parsers</span> = {}
  (<span class="ruby-ivar">@block_parsers</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@span_parsers</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">has_parser?</span>(<span class="ruby-identifier">name</span>)
      <span class="ruby-ivar">@parsers</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">parser</span>(<span class="ruby-identifier">name</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;Unknown parser: #{name}&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@span_start</span>, <span class="ruby-ivar">@span_start_re</span> = <span class="ruby-identifier">span_parser_regexps</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- configure_parser-source -->
          
        </div>

        

        
      </div><!-- configure_parser-method -->

    
      <div id="method-i-new_block_el" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new_block_el</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Create a new block-level element, taking care of applying a preceding block
IAL if it exists. This method should always be used for creating a
block-level element!</p>
          
          

          
          <div class="method-source-code" id="new_block_el-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 290</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new_block_el</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">el</span> = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@block_ial</span>
    <span class="ruby-identifier">el</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>] = <span class="ruby-ivar">@block_ial</span>
    <span class="ruby-ivar">@block_ial</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">el</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new_block_el-source -->
          
        </div>

        

        
      </div><!-- new_block_el-method -->

    
      <div id="method-i-parse_blocks" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_blocks</span><span
            class="method-args">(el, text = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse all block-level elements in <code>text</code> into the element
<code>el</code>.</p>
          
          

          
          <div class="method-source-code" id="parse_blocks-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 130</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_blocks</span>(<span class="ruby-identifier">el</span>, <span class="ruby-identifier">text</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-ivar">@stack</span>.<span class="ruby-identifier">push</span>([<span class="ruby-ivar">@tree</span>, <span class="ruby-ivar">@src</span>, <span class="ruby-ivar">@block_ial</span>])
  <span class="ruby-ivar">@tree</span>, <span class="ruby-ivar">@block_ial</span> = <span class="ruby-identifier">el</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@src</span> = (<span class="ruby-identifier">text</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@src</span> <span class="ruby-operator">:</span> <span class="ruby-operator">::</span><span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">StringScanner</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">el</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:location</span>]))

  <span class="ruby-identifier">status</span> = <span class="ruby-identifier">catch</span>(<span class="ruby-value">:stop_block_parsing</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">while</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>.<span class="ruby-identifier">eos?</span>
      <span class="ruby-ivar">@block_parsers</span>.<span class="ruby-identifier">any?</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-ivar">@parsers</span>[<span class="ruby-identifier">name</span>].<span class="ruby-identifier">start_re</span>)
          <span class="ruby-identifier">send</span>(<span class="ruby-ivar">@parsers</span>[<span class="ruby-identifier">name</span>].<span class="ruby-identifier">method</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">false</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">begin</span>
        <span class="ruby-identifier">warning</span>(<span class="ruby-string">&#39;Warning: this should not occur - no block parser handled the line&#39;</span>)
        <span class="ruby-identifier">add_text</span>(<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/.*\n/</span>))
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@tree</span>, <span class="ruby-ivar">@src</span>, <span class="ruby-ivar">@block_ial</span> = <span class="ruby-operator">*</span><span class="ruby-ivar">@stack</span>.<span class="ruby-identifier">pop</span>
  <span class="ruby-identifier">status</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_blocks-source -->
          
        </div>

        

        
      </div><!-- parse_blocks-method -->

    
      <div id="method-i-parse_spans" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_spans</span><span
            class="method-args">(el, stop_re = nil, parsers = nil, text_type = @text_type) { |: true)| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse all span-level elements in the source string of @src into
<code>el</code>.</p>

<p>If the parameter <code>stop_re</code> (a regexp) is used, parsing is
immediately stopped if the regexp matches and if no block is given or if a
block is given and it returns <code>true</code>.</p>

<p>The parameter <code>parsers</code> can be used to specify the (span-level)
parsing methods that should be used for parsing.</p>

<p>The parameter <code>text_type</code> specifies the type which should be
used for created text nodes.</p>
          
          

          
          <div class="method-source-code" id="parse_spans-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 195</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_spans</span>(<span class="ruby-identifier">el</span>, <span class="ruby-identifier">stop_re</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">parsers</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">text_type</span> = <span class="ruby-ivar">@text_type</span>)
  <span class="ruby-ivar">@stack</span>.<span class="ruby-identifier">push</span>([<span class="ruby-ivar">@tree</span>, <span class="ruby-ivar">@text_type</span>]) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@tree</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@tree</span>, <span class="ruby-ivar">@text_type</span> = <span class="ruby-identifier">el</span>, <span class="ruby-identifier">text_type</span>

  <span class="ruby-identifier">span_start</span> = <span class="ruby-ivar">@span_start</span>
  <span class="ruby-identifier">span_start_re</span> = <span class="ruby-ivar">@span_start_re</span>
  <span class="ruby-identifier">span_start</span>, <span class="ruby-identifier">span_start_re</span> = <span class="ruby-identifier">span_parser_regexps</span>(<span class="ruby-identifier">parsers</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">parsers</span>
  <span class="ruby-identifier">parsers</span> = <span class="ruby-identifier">parsers</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@span_parsers</span>

  <span class="ruby-identifier">used_re</span> = (<span class="ruby-identifier">stop_re</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">span_start_re</span> <span class="ruby-operator">:</span> <span class="ruby-node">/(?=#{Regexp.union(stop_re, span_start)})/</span>)
  <span class="ruby-identifier">stop_re_found</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">while</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@src</span>.<span class="ruby-identifier">eos?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">stop_re_found</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">scan_until</span>(<span class="ruby-identifier">used_re</span>)
      <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">result</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">stop_re</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-identifier">stop_re</span>)
        <span class="ruby-identifier">stop_re_found</span> = (<span class="ruby-identifier">block_given?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">yield</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">processed</span> = <span class="ruby-identifier">parsers</span>.<span class="ruby-identifier">any?</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-ivar">@parsers</span>[<span class="ruby-identifier">name</span>].<span class="ruby-identifier">start_re</span>)
          <span class="ruby-identifier">send</span>(<span class="ruby-ivar">@parsers</span>[<span class="ruby-identifier">name</span>].<span class="ruby-identifier">method</span>)
          <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">false</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">stop_re_found</span>
      <span class="ruby-identifier">add_text</span>(<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">getch</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">processed</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">stop_re_found</span>
    <span class="ruby-keyword">else</span>
      (<span class="ruby-identifier">add_text</span>(<span class="ruby-ivar">@src</span>.<span class="ruby-identifier">rest</span>); <span class="ruby-ivar">@src</span>.<span class="ruby-identifier">terminate</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">stop_re</span>
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@tree</span>, <span class="ruby-ivar">@text_type</span> = <span class="ruby-ivar">@stack</span>.<span class="ruby-identifier">pop</span>

  <span class="ruby-identifier">stop_re_found</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_spans-source -->
          
        </div>

        

        
      </div><!-- parse_spans-method -->

    
      <div id="method-i-reset_env" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset_env</span><span
            class="method-args">(opts = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reset the current parsing environment. The parameter <code>env</code> can
be used to set initial values for one or more environment variables.</p>
          
          

          
          <div class="method-source-code" id="reset_env-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 234</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset_env</span>(<span class="ruby-identifier">opts</span> = {})
  <span class="ruby-identifier">opts</span> = {<span class="ruby-value">:text_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:raw_text</span>, <span class="ruby-value">:stack</span> =<span class="ruby-operator">&gt;</span> []}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>)
  <span class="ruby-ivar">@src</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:src</span>]
  <span class="ruby-ivar">@tree</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:tree</span>]
  <span class="ruby-ivar">@block_ial</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:block_ial</span>]
  <span class="ruby-ivar">@stack</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:stack</span>]
  <span class="ruby-ivar">@text_type</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:text_type</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- reset_env-source -->
          
        </div>

        

        
      </div><!-- reset_env-method -->

    
      <div id="method-i-restore_env" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">restore_env</span><span
            class="method-args">(env)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Restore the current parsing environment.</p>
          
          

          
          <div class="method-source-code" id="restore_env-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 249</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">restore_env</span>(<span class="ruby-identifier">env</span>)
  <span class="ruby-ivar">@src</span>, <span class="ruby-ivar">@tree</span>, <span class="ruby-ivar">@block_ial</span>, <span class="ruby-ivar">@stack</span>,  <span class="ruby-ivar">@text_type</span> = <span class="ruby-operator">*</span><span class="ruby-identifier">env</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- restore_env-source -->
          
        </div>

        

        
      </div><!-- restore_env-method -->

    
      <div id="method-i-save_env" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_env</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return the current parsing environment.</p>
          
          

          
          <div class="method-source-code" id="save_env-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 244</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_env</span>
  [<span class="ruby-ivar">@src</span>, <span class="ruby-ivar">@tree</span>, <span class="ruby-ivar">@block_ial</span>, <span class="ruby-ivar">@stack</span>,  <span class="ruby-ivar">@text_type</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- save_env-source -->
          
        </div>

        

        
      </div><!-- save_env-method -->

    
      <div id="method-i-span_parser_regexps" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">span_parser_regexps</span><span
            class="method-args">(parsers = @span_parsers)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Create the needed span parser regexps.</p>
          
          

          
          <div class="method-source-code" id="span_parser_regexps-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 124</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">span_parser_regexps</span>(<span class="ruby-identifier">parsers</span> = <span class="ruby-ivar">@span_parsers</span>)
  <span class="ruby-identifier">span_start</span> = <span class="ruby-node">/#{parsers.map {|name| @parsers[name].span_start}.join(&#39;|&#39;)}/</span>
  [<span class="ruby-identifier">span_start</span>, <span class="ruby-node">/(?=#{span_start})/</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- span_parser_regexps-source -->
          
        </div>

        

        
      </div><!-- span_parser_regexps-method -->

    
      <div id="method-i-update_attr_with_ial" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_attr_with_ial</span><span
            class="method-args">(attr, ial)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Update the given attributes hash <code>attr</code> with the information
from the inline attribute list <code>ial</code> and all referenced ALDs.</p>
          
          

          
          <div class="method-source-code" id="update_attr_with_ial-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 255</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_attr_with_ial</span>(<span class="ruby-identifier">attr</span>, <span class="ruby-identifier">ial</span>)
  <span class="ruby-identifier">ial</span>[<span class="ruby-value">:refs</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ref</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">update_attr_with_ial</span>(<span class="ruby-identifier">attr</span>, <span class="ruby-identifier">ref</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">ref</span> = <span class="ruby-ivar">@alds</span>[<span class="ruby-identifier">ref</span>]
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ial</span>[<span class="ruby-value">:refs</span>]
  <span class="ruby-identifier">ial</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-constant">IAL_CLASS_ATTR</span>
      <span class="ruby-identifier">attr</span>[<span class="ruby-identifier">k</span>] = (<span class="ruby-identifier">attr</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; #{v}&quot;</span>
      <span class="ruby-identifier">attr</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">lstrip!</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">String</span>)
      <span class="ruby-identifier">attr</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_attr_with_ial-source -->
          
        </div>

        

        
      </div><!-- update_attr_with_ial-method -->

    
      <div id="method-i-update_link_definitions" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_link_definitions</span><span
            class="method-args">(link_defs)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Update the parser specific link definitions with the data from
<code>link_defs</code> (the value of the :link_defs option).</p>

<p>The parameter <code>link_defs</code> is a hash where the keys are possibly
unnormalized link IDs and the values are two element arrays consisting of
the link target and a title (can be <code>nil</code>).</p>
          
          

          
          <div class="method-source-code" id="update_link_definitions-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 106</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_link_definitions</span>(<span class="ruby-identifier">link_defs</span>)
  <span class="ruby-identifier">link_defs</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@link_defs</span>[<span class="ruby-identifier">normalize_link_id</span>(<span class="ruby-identifier">k</span>)] = <span class="ruby-identifier">v</span>}
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_link_definitions-source -->
          
        </div>

        

        
      </div><!-- update_link_definitions-method -->

    
      <div id="method-i-update_raw_header_text" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_raw_header_text</span><span
            class="method-args">(header)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Update the raw header text for automatic ID generation.</p>
          
          

          
          <div class="method-source-code" id="update_raw_header_text-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 270</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_raw_header_text</span>(<span class="ruby-identifier">header</span>)
  <span class="ruby-comment"># DEPRECATED: option auto_id_stripping will be removed in 2.0 because then this will be the</span>
  <span class="ruby-comment"># default behaviour</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@options</span>[<span class="ruby-value">:auto_id_stripping</span>]
  <span class="ruby-identifier">raw_text</span> = <span class="ruby-string">&#39;&#39;</span>

  <span class="ruby-identifier">append_text</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:text</span>
      <span class="ruby-identifier">raw_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">value</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">child</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">append_text</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">c</span>)}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">append_text</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">header</span>)
  <span class="ruby-identifier">header</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:raw_text</span>] = <span class="ruby-identifier">raw_text</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_raw_header_text-source -->
          
        </div>

        

        
      </div><!-- update_raw_header_text-method -->

    
      <div id="method-i-update_tree" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_tree</span><span
            class="method-args">(element)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Update the tree by parsing all :<code>raw_text</code> elements with the
span-level parser (resets the environment) and by updating the attributes
from the IALs.</p>
          
          

          
          <div class="method-source-code" id="update_tree-source">
            <pre><span class="ruby-comment"># File lib/kramdown/parser/kramdown.rb, line 156</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_tree</span>(<span class="ruby-identifier">element</span>)
  <span class="ruby-identifier">last_blank</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">element</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:raw_text</span>
      <span class="ruby-identifier">last_blank</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">reset_env</span>(<span class="ruby-value">:src</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">::</span><span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">StringScanner</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">child</span>.<span class="ruby-identifier">value</span>, <span class="ruby-identifier">element</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:location</span>]),
                <span class="ruby-value">:text_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:text</span>)
      <span class="ruby-identifier">parse_spans</span>(<span class="ruby-identifier">child</span>)
      <span class="ruby-identifier">child</span>.<span class="ruby-identifier">children</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:eob</span>
      <span class="ruby-identifier">update_attr_with_ial</span>(<span class="ruby-identifier">child</span>.<span class="ruby-identifier">attr</span>, <span class="ruby-identifier">child</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>]
      []
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:blank</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">last_blank</span>
        <span class="ruby-identifier">last_blank</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">value</span>
        []
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">last_blank</span> = <span class="ruby-identifier">child</span>
        <span class="ruby-identifier">child</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">last_blank</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">update_tree</span>(<span class="ruby-identifier">child</span>)
      <span class="ruby-identifier">update_attr_with_ial</span>(<span class="ruby-identifier">child</span>.<span class="ruby-identifier">attr</span>, <span class="ruby-identifier">child</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:ial</span>]
      <span class="ruby-identifier">update_raw_header_text</span>(<span class="ruby-identifier">child</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:header</span>
      <span class="ruby-identifier">child</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">flatten!</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_tree-source -->
          
        </div>

        

        
      </div><!-- update_tree-method -->

    
    </section><!-- protected-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 4.0.0.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

