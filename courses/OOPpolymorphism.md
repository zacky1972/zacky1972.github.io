---
title: オブジェクト指向プログラミング〜ポリモーフィズム
layout: post
excerpt: このテキストでは，オブジェクト指向プログラミングの原動力であるポリモーフィズムについて説明します。
---
# オブジェクト指向プログラミング〜ポリモーフィズム

このテキストでは，オブジェクト指向プログラミングの原動力であるポリモーフィズムについて説明します。

## クラスと属性・操作

クラスは，クラス名の他に，属性と操作を持ちます。

* クラス名: クラスの名称
* 属性(attribute): クラスが持っている性質。属性の型と属性名を持ちます。例: 整数型の id という属性
* 操作(operation): クラスができる機能。操作は，その操作が返す型と，操作名と，必要に応じて引数を持ちます。例: 整数型を返す add という操作。add の引数は整数型の a と b。

UML ではクラスを表す矩形の中を3つに区切って，上から順にクラス名，属性，操作の順番で表記します。

![3領域のクラス表記](/assets/images/class-3regions.png)

クラスの矩形の中を2つに区切った時には，上から順にクラス名，属性の順で表記して，操作を省略します。

![2領域のクラス表記](/assets/images/class-2regions.png)

クラスの矩形の中が1つしかない時にはクラス名だけを表記します。

![2領域のクラス表記](/assets/images/class-1region.png)

クラス名と操作を表記して，属性を省略したい時には，クラスの矩形の中を3つに区切って真ん中の属性を書くべき領域を空白にします。

![属性のない3領域のクラス表記](/assets/images/class-3regions-without-attribute.png)

UML では属性・操作という言葉を使いますが，プログラミング言語では異なる言葉を使うことがあります。

* C++ の場合:
	* 属性: メンバー変数(member variable)
	* 操作: メソッド(method)
* Ruby の場合:
	* 属性: インスタンス変数(instance variable)
	* 操作: メソッド(method)

## 言葉の確認 

下記の概念がわからなかったら，モデリングの Lesson1 を復習してください。

* 汎化
* スーパークラス
* サブクラス

## 継承とは？

2つのクラスに汎化関係が成立している時には，スーパークラスにある性質をサブクラスが継承しています。どういうことかというと，サブクラスはスーパークラスが持っている属性と操作を継承しているということです。

この性質により次の性質が成立します。

* サブクラスはスーパークラスの代わりができる
* サブクラスのインスタンスはスーパークラスの変数に代入できる

ただし，逆はできないかもしれないです。もちろん，できる場合もあります。その理由は，サブクラスが機能を拡張している，すなわち新たな操作を足している場合には，スーパークラスはサブクラスの代わりができないからです。

## ポリモーフィズム

次のようなペット型ロボットの例を考えます。

* スーパークラス: ペット型ロボット
* サブクラス: ネコ型，イヌ型

モデリング演習の Lesson4 ，汎化と関連の組み合わせを復習しながら，クラス図を描いてみてください。

* 関連元: Client
* 関連先: ペット型ロボット
* Client はペット型ロボットを使う

クラス図は次の通りです。

![ペット型ロボットのクラス図](/assets/images/pet-uml.png)

Client というのは，顧客のことですが，ここではその意味から転じて，利用する側のプログラムのことを指します。

ここで，操作として「喜ぶ」「怒る」を定義したとします。

* ネコ型ロボットは，怒る時に，ひっかく
* イヌ型ロボットは，怒る時に，ほえる
* ネコ型ロボットは，喜ぶ時に，のどを鳴らす
* イヌ型ロボットは，喜ぶ時に，しっぽを振る

という具合に同じメソッドを実行した時の振る舞いが異なります。

このようなことを，ポリモーフィズム (polymorphism) といいます。

なお，クラス Pet とそのメソッドの名前が斜体(イタリック)になっているのは，これらには実体がない抽象クラス，抽象メソッドであるということを表しています。詳しくはサンプルプログラムのところで説明します。

## ポリモーフィズムのサンプルプログラム

各言語によるポリモーフィズムのサンプルプログラムを紹介します。

* [C++のコード](/courses/OOPpolymorphismCPP.html)


<a name="whyPolymorphism"></a>
## ポリモーフィズムの意義

なんでポリモーフィズムがあるかというと，どのサブクラスであったとしても，Client のコードはそのままで実行できるという利点があるからです。この利点により，コードの再利用性が高まるので，ソフトウェア開発の生産性が高くなります。

## 演習問題 ポリモーフィズム

### 演習問題1

怒る動作を次のように変えてみてください。
	* ネコ型ロボットは，怒る時に，ひっかく，毛を逆立てる
	* イヌ型ロボットは，怒る時に，ほえる，噛む

### 演習問題2

このプログラムに，喜ぶ: rejoice というメソッドを追加してみてください。ただし Pet クラスにも rejoice メソッドを追加する必要がある点に注意してください。

<a name="ex3"></a>
### 演習問題3

次のクラス図を実装してみてください。

![価格の計算](/assets/images/product-uml.png)

※ SetPrice メソッドは，スーパークラスに定義されています。この場合，サブクラスで SetPrice を呼び出すと，スーパークラスの SetPrice が呼ばれます。このように，サブクラスに共通する処理をスーパークラスで定義することができます。

ただし，次のような価格を取得できるようにしてください。

* 特売品は定価の50%引き
* 新製品は定価の2倍に100を足す

クラス Product と Client のコードは下記のコードを参考にしてください。　

* [C++のコード](/courses/OOPpolymorphismCPP.html#product)

### 演習問題4

ポリモーフィズムになりそうな例を考えて，クラス図に書いてみましょう。

### 演習問題5

演習問題4で考えた，ポリモーフィズムになりそうな例を実装しましょう。

今までの例にあるように，Clientから呼ばれた時のふるまいを数値や文字列で表して，Client 側でそれを表示するようにしてください。
